"use strict";function BindEven(){$("body").on("click",".j-close-dialog",function(){$(".j-dialog").fadeOut(50),setTimeout(function(){$(".j-dialog").remove()},50)}),$("body").on("click","#lyjl_nav",ShowDialog),$("body").on("click",".j-bg",ShowDialog),$("body").on("click",".close-dialog",RemoveDialog),$("body").on("click",".j-nav-box button",SelectFunctionPage),$("body").on("mouseover","li.list-style-none .lazy-image",GetPublicIdForAll),$("body").on("mouseover","li.search-result .lazy-image",GetPublicIdForSearch),$("body").on("mouseover","li.search-result .ivm-view-attr__ghost-entity",GetPublicIdForSearch),$("body").on("mouseover",".pv-top-card__photo",GetPublicIdForHome),$("body").on("mouseout","li.list-style-none .lazy-image",RemoveBubble),$("body").on("mouseout","li.search-result .lazy-image",RemoveBubble),$("body").on("mouseout","li.search-result .ivm-view-attr__ghost-entity",RemoveBubble),$("body").on("mouseout",".pv-top-card__photo",RemoveBubble),$("body").on("mouseout","li.list-style-none .lazy-image",RemoveFid),$("body").on("mouseout","li.search-result .lazy-image",RemoveFid),$("body").on("mouseout","li.search-result .ivm-view-attr__ghost-entity",RemoveFid),$("body").on("mouseout",".pv-top-card__photo",RemoveFid),$("body").on("keydown","#j_friend_keyword",SearchFriendEnter),$("body").on("click","#j_friend_search",SearchFriend),$("body").on("click","#j_more_condition",ShowMoreCondition),$("body").on("keydown","#j_friend_paging .j-curpage",JumpFriend),$("body").on("click","#j_friend_paging  .j-paging",GetFriendSomePage),$("body").on("click","#j_friend_box .j-profile",ShowFriendToolbar),$("body").on("click","input[name='selectallfriend']",SelectAllFriend),$("body").on("click","#j_friend_tool .j-ico-whitelist",AddWhitelist),$("body").on("click","#j_friend_tool .j-ico-sendmsg",StartFriendSendMsg),$("body").on("click","#j_friend_tool .j-ico-dig",StartFriendDigForBatch),$("body").on("click","#j_friend_tool .j-ico-group",StartGroupingForFriend),$("body").on("click","#j_clean_condition",CleanCondition),$("body").on("input","#j_search_country",GetSearchCountry),$("body").on("click",".j-bg-search-condition",ShowOrHideSearch),$("body").on("click",".j-country-span",SelectCountry),$("body").on("click","#j_clean_country",CleanSelectCountry),$("body").on("click","#j_determine_country",DetermineSelectCountry),$("body").on("input","#j_search_company",GetSearchCompany),$("body").on("click",".j-company-span",SelectCompany),$("body").on("click","#j_clean_company",CleanSelectCompany),$("body").on("click","#j_determine_company",DetermineSelectCompany),$("body").on("input","#j_search_school",GetSearchSchool),$("body").on("click",".j-school-span",SelectSchool),$("body").on("click","#j_clean_school",CleanSelectSchool),$("body").on("click","#j_determine_school",DetermineSelectSchool),$("body").on("keydown","#j_group_keyword",GetGroupEnter),$("body").on("click","#j_group_search",GetGroup),$("body").on("click",".j-group",ShowGroupDetail),$("body").on("click",".j-load-friend",LoadMoreGroupFriend),$("body").on("click","#j_group_tool .j-ico-newgroup",NewGroup),$("body").on("click","#j_new_group",SaveNewGroup),$("body").on("click",".j-delete-group",DeleteGroup),$("body").on("click",".j-edit-group",ReviseGroup),$("body").on("click",".j-sort",StartSortGroup),$("body").on("click",".j-ico-up",SortUp),$("body").on("click",".j-ico-down",SortDown),$("body").on("click","#j_revise_group",SaveReviseGroup),$("body").on("click",".j-group-tool .j-movegroup",StartMoveGroupForBatch),$("body").on("click",".j-friend-toolbar .j-friend-edit",EditFriendRemark),$("body").on("click",".j-gall",SelectAllGroupFriend),$("body").on("click",".j-g-detail .j-profile",ShowMoreEdit),$("body").on("click",".j-group-tool .j-ico-sendmsg",StartGroupSendMsg),$("body").on("click",".j-group-tool .j-friend-delete",DeleteFriendOnGroup),$("body").on("click","#j_add_firstname",AddFirstName),$("body").on("click","#j_add_lastname",AddLastName),$("body").on("click",".j-delete-tidings",DeleteTidings),$("body").on("click","#j_tidings_box input[name='tidings']",SelectTidings),$("body").on("dblclick",".j-tab-tidings tbody tr td:nth-child(2)",ReviseTidings),$("body").on("blur",".j-revise",UpdateTidings),$("body").on("click","#j_startsend",StartSendMsg),$("body").on("click",".j-updatewhitelist",UpdateWhitelist),$("body").on("click",".j-dig",StartDigForA),$("body").on("click",".j-group-tool .j-ico-dig",StartGroupDigForBatch),$("body").on("click",".j-group-tool .j-ico-whitelist",AddWhitelistForGroup),$("body").on("keydown","#j_dig_keyword",SearchDigEnter),$("body").on("click","#j_dig_search",SearchDig),$("body").on("click","input[name='selectalldig']",SelectAllDig),$("body").on("keydown","#j_dig_paging .j-curpage",JumpDig),$("body").on("click","#j_dig_paging  .j-paging",GetDigSomePage),$("body").on("dblclick","#j_dig_box .j-profile",GetProfile),$("body").on("click","#j_dig_tool .j-ico-export",ExportDig),$("body").on("keydown","#j_probe_keyword",StartProbeEnter),$("body").on("click","#j_probe_search",StartProbe),$("body").on("keydown","#j_probe_paging .j-curpage",JumpProbe),$("body").on("click","input[name='selectallprobe']",SelectAllProbe),$("body").on("click","#j_probe_paging .j-paging",ProbeSomePage),$("body").on("click","#j_probe_tool .j-ico-export",ExportProbe),$("body").on("dblclick","#j_probe_box .j-profile",GetProfile),$("body").on("mousedown",".j-detail-bg",RemoveDialog),$("body").on("keydown","#j_whitelist_keyword",SearchWhitelistEnter),$("body").on("click","#j_whitelist_search",SearchWhitelist),$("body").on("keydown","#j_whitelist_paging .j-curpage",JumpWhitelist),$("body").on("click","#j_whitelist_paging  .j-paging",GetWhitelistSomePage),$("body").on("click","input[name='selectallwhitelist']",SelectAllWhitelist),$("body").on("click","#j_whitelist_tool .j-ico-delete",DeleteWhitelist),$("body").on("click","#j_has_send",GetHasSent),$("body").on("click","input[name='selectallinvite']",SelectAllInvite),$("body").on("click","#j_recall",RecallBatch),$("body").on("keydown","#j_invite_paging .j-curpage",JumpInvite),$("body").on("click","#j_invite_paging .j-paging",GetInviteSomePage),$("body").on("click",".j-fold-head",ShowSetDetail),$("body").on("click","#restore_set",RestoreSet),$("body").on("change","#s_min_speed",SetSendMinSpeed),$("body").on("change","#s_max_speed",SetSendMaxSpeed),$("body").on("click","#s_skip",SetSendSkip),$("body").on("change","#s_skip_time",SetSendSkipTime),$("body").on("change","#s_limit",SetSendLimit),$("body").on("change","#a_min_speed",SetAddMinSpeed),$("body").on("change","#a_max_speed",SetAddMaxSpeed),$("body").on("change","#a_limit",SetAddLimit),$("body").on("change","#d_min_speed",SetDigMinSpeed),$("body").on("change","#d_max_speed",SetDigMaxSpeed),$("body").on("change","#d_limit",SetDigLimit),$("body").on("change","#t_min_speed",SetThumbsMinSpeed),$("body").on("change","#t_max_speed",SetThumbsMaxSpeed),$("body").on("change","#t_limit",SetThumbsLimit),$("body").on("click","#j_risk",SetRisk),$("body").on("click","#j_tips",SetTips),$("body").on("click","#j_login",Login),$("body").on("keydown","#j_pw",LoginEnter),$("body").on("click","#j_change_account",CreatLoginDialog),$("body").on("click","#j_stop_action",StopAction),$("body").on("click","#j_guide_statu",SetGuideStatu),$("body").on("click","#j_logout",LogOut),$("body").on("click","#j_about_me",AboutMe),$("body").on("click","#j_log",ShowLog),$("body").on("click","#j_recover",Recover),$("body").on("click",".j-upvip",UpVip),$("body").on("click","#j_bind",ChangeLinkedin),$("body").on("click","#j_opinion",ShowProPose),$("body").on("click","#j_level",ShowLevel),$("body").on("click","#j_addfriend",StartAddFriend),$("body").on("click","#j_thumbs",StartThumbs),$("body").on("blur","#j_invite_msg",SaveInviteMsg),$("body").on("click","#j_add_invite",StartAddFriendForSearch),$("body").on("click","#j_add_first",InsertFirstName),$("body").on("click","#j_add_last",InsertLastName)}function BindLinkedin(e){chrome.storage.sync.get({my_urn:""},function(t){var i=String(t.my_urn),n=window.location.href,o=new RegExp("linkedin.com/feed","i"),a=new RegExp("linkedin.com/login","i");if(!i||o.test(n)||e){var r=getCookie("JSESSIONID").replace(/"/g,"");if(!r)return!1;var n="https://www.linkedin.com/voyager/api/me";$.ajax({url:n,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":r,"x-restli-protocol-version":"2.0.0"},success:function(t){if(t){var i=t.included[0].firstName,n=t.included[0].lastName,o=GetName(i,n),a=t.included[0].entityUrn.split(":")[3],r=t.included[0].publicIdentifier;if(t.included[0].picture)var s=t.included[0].picture.rootUrl+t.included[0].picture.artifacts[0].fileIdentifyingUrlPathSegment;else var s="";if(a){chrome.storage.sync.set({my_urn:[a],publicId:[r],name:[o],img:[s]},function(){e&&PointOut("绑定成功",3)});var c={my_urn:a,publicId:r,firstname:i,lastname:n,img:s};c=JSON.stringify(c),chrome.runtime.sendMessage({action:"upload",type:"saveEntityUrn",data:c,other:""},function(e){})}}},error:function(){e&&PointOut("绑定失败",3)}})}a.test(n)&&chrome.storage.sync.set({my_urn:""},function(){})})}function AppendNav(){$("body").prepend('<div id="lyjl_nav" class="j-nav-main" title="领英精灵"><div class="j-ico j-ico-nav-logo" style="margin:auto;"></div><p class="j-nav-p" style="font-size:1.3rem;">领英精灵</p></div>')}function AppendWindow(){chrome.runtime.sendMessage({action:"getHtml"},function(e){$("body").append(e.result)})}function ShowDialog(){if($("#lyjl_nav").hasClass("j-nav-main-active"))$("#lyjl_nav").removeClass("j-nav-main-active"),$("#lyjl_nav").find(".j-ico").removeClass("j-ico-nav-logo-active"),$("#lyjl_nav").find(".j-ico").addClass("j-ico-nav-logo"),$("#lyjl_nav").find("p").removeClass("j-nav-p-active"),$("#lyjl_nav").find("p").addClass("j-nav-p"),$(".j-bg").remove();else{$("#lyjl_nav").addClass("j-nav-main-active"),$("#lyjl_nav").find(".j-ico").removeClass("j-ico-nav-logo"),$("#lyjl_nav").find(".j-ico").addClass("j-ico-nav-logo-active"),$("#lyjl_nav").find("p").removeClass("j-nav-p"),$("#lyjl_nav").find("p").addClass("j-nav-p-active");$("body").append('<div class="j-bg close-dialog" title="选择好友时，请先隐藏领英精灵界面"></div>');var e=$("#lyjl").height()-142;$(".j-cont-box").css("max-height",e+"px"),InitLogin()}$(".j-content-box").slideToggle(200)}function RemoveDialog(){$(".j-dialog").remove()}function InitUi(){chrome.storage.sync.get({img:"",name:"",my_urn:"",option:"friend",level:0},function(e){var t=String(e.img),i=String(e.my_urn),n=String(e.option);i?($(".j-head-img").attr("title",e.name),t&&$(".j-head-img").attr("src",t)):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})),parseInt(e.level)>2?$("#j_option_probe").parent("li").css("display","block"):$("#j_option_probe").parent("li").css("display","none"),ShowOption(n)})}function ShowOption(e){switch($("#lyjl .j-nav-box li button").each(function(){$(this).attr("data-option")==e?($(this).removeClass("j-active-not"),$(this).addClass("j-active")):($(this).removeClass("j-active"),$(this).addClass("j-active-not"))}),$("#lyjl section").removeClass("j-select"),$("#lyjl section").addClass("j-select-not"),$("#j_"+e).removeClass("j-select-not"),$("#j_"+e).addClass("j-select"),e){case"friend":ShowFriendPage();break;case"group":ShowGroupPage();break;case"dig":ShowDigPage();break;case"probe":ShowProbePage();break;case"whitelist":ShowWhitelistPage();break;case"set":ShowSetPage();break;case"invite":ShowInvitePage()}chrome.storage.sync.set({option:[e]},function(){})}function SelectFunctionPage(){if(!$(this).hasClass("j-active")){ShowOption($(this).attr("data-option"))}}function GetPublicIdForAll(){var e=e||window.event;PosX=e.screenX,PosY=e.screenY;var t=$(this);ShowBubble=!0,setTimeout(function(){var e=$.trim(ArrangeFid(decodeURIComponent(t.parents("li.list-style-none").find("[data-control-name=connection_profile]").attr("href"))));Fid=e,Dist=1,chrome.storage.sync.get({tips:!0},function(t){e&&t.tips&&chrome.runtime.sendMessage({action:"getFriendDetail",publicId:e},function(e){})})},100)}function GetPublicIdForSearch(){var e=e||window.event;PosX=e.screenX,PosY=e.screenY;var t=$(this).parents("li.search-result");ShowBubble=!0,setTimeout(function(){var e=$.trim(ArrangeFid(decodeURIComponent(t.find(".search-result__info .search-result__result-link").attr("href")))),i=parseInt(t.find(".dist-value").text());Fid=e,Dist=i,chrome.storage.sync.get({tips:!0},function(t){if(!t.tips)return!1;if(e&&1==i)chrome.runtime.sendMessage({action:"getFriendDetail",publicId:e},function(e){});else{RemoveBubble();$("body").append('<div id="j_bubble" class="j-bubble-box"><div><span>非好友</span></div></div>'),$("#j_bubble").css("left",PosX+"px"),$("#j_bubble").css("top",PosY+"px")}})},100)}function GetPublicIdForHome(){var e=e||window.event;PosX=e.screenX,PosY=e.screenY,ShowBubble=!0,setTimeout(function(){var e=ArrangeFid($.trim(decodeURIComponent(window.location.pathname))),t=parseInt($(".dist-value:first").text());Fid=e,Dist=t,chrome.storage.sync.get({tips:!0},function(i){if(!i.tips)return!1;if(e&&1==t)chrome.runtime.sendMessage({action:"getFriendDetail",publicId:e},function(e){});else{RemoveBubble();$("body").append('<div id="j_bubble" class="j-bubble-box"><div><span>非好友</span></div></div>'),$("#j_bubble").css("left",PosX+"px"),$("#j_bubble").css("top",PosY+"px")}})},100)}function GetFriendDetailResult(e,t){if(!ShowBubble)return!1;if(1==e){if(t){var i=1==t.is_dig?"是":"否",n=1==t.is_whitelist?"是":"否",o=t.group_name?t.group_name:"未分组";if(t.send_time&&t.send_time>315504e6)var a=new Date(t.send_time).Format("yyyy-MM-dd");else var a="未群发过";var r=t.remarks}else var i="否",n="否",o="未分组",a="未群发过",r="";RemoveBubble();var s='<div id="j_bubble" class="j-bubble-box"><div><font>分组：</font><span>'+o+"</span></div><div><font>挖掘：</font><span>"+i+"</span></div><div><font>禁发：</font><span>"+n+"</span></div><div><font>群发：</font><span>"+a+"</span></div><div><font>备注：</font><span>"+r+"</span></div></div>";$("body").append(s),$("#j_bubble").css("left",PosX+"px"),$("#j_bubble").css("top",PosY+"px")}}function RemoveBubble(){ShowBubble=!1,$(".j-bubble-box").remove()}function RemoveFid(){setTimeout(function(){Fid="",Dist=""},50)}function AddWhitelistForRight(){chrome.storage.sync.get({account:"",my_urn:"",level:0},function(e){var t=String(e.account),i=String(e.my_urn);if(!t)return alert("没有登录领英精灵账号，请先登录领英精灵账号"),!1;if(!i)return confirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？")&&BindLinkedin(),!1;if(parseInt(e.level)<1)return confirm("普通会员不支持禁发名单功能，请升级VIP会员使用，确定要升级吗？")&&UpVip(),!1;var n=Fid;return n?1!=Dist?(GPointOut("非好友，不支持添加到禁发名单,请选择1度人脉",3),!1):void chrome.runtime.sendMessage({action:"addWhitelistForRight",publicid:n},function(e){}):(GPointOut("请将鼠标放在好友头像上，选择要添加到禁发名单的好友",3),!1)})}function GetFriendForAddWhitelist(e,t){switch(e){case 0:GPointOut("添加失败");break;case 1:t=JSON.stringify(t),chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:t,other:1,tag:"rightClick"},function(e){});break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:confirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？")&&BindLinkedin(!0);break;case 4:var i=getCookie("JSESSIONID").replace(/"/g,"");if(!i)return PointOut("添加失败",1),!1;var n="https://www.linkedin.com/voyager/api/identity/profiles/"+t+"/profileView";$.ajax({url:n,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":i,"x-restli-protocol-version":"2.0.0"},success:function(e){var i=e.included,n=[];if(i)for(var o=0;o<i.length;o++)if("com.linkedin.voyager.identity.shared.MiniProfile"==i[o].$type){var a=i[o],r={};r.publicId=t,a&&a.firstName?r.firstName=a.firstName:r.firstName="",a&&a.lastName?r.lastName=a.lastName:r.lastName="",a&&a.occupation?r.position=a.occupation.substr(0,120):r.position="",a&&a.picture&&a.picture.rootUrl&&a.picture.artifacts&&a.picture.artifacts[0].fileIdentifyingUrlPathSegment?r.img=a.picture.rootUrl+a.picture.artifacts[0].fileIdentifyingUrlPathSegment:r.img="",a&&a.entityUrn?r.entityUrn=a.entityUrn.split(":")[3]:r.entityUrn=null,n.push(r)}var s=JSON.stringify(n);chrome.runtime.sendMessage({action:"upload",type:"saveFriend",data:s,other:0},function(e){});var c=[];c.push(n[0].entityUrn),c=JSON.stringify(c),setTimeout(function(){chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:c,other:1,tag:"rightClick"},function(e){})},100)},error:function(){GPointOut("添加失败")}});break;default:GPointOut("添加失败")}}function GetFriend(){var e=window.location.href;if(!new RegExp("linkedin.com/feed","i").test(e))return!1;chrome.storage.sync.get({account:"",my_urn:"",getFriendPos:0,getFriend:!0},function(e){if(!e.getFriend||parseInt(e.getFriendPos)>4e3)return!1;var t=String(e.account),i=String(e.my_urn);if(!t||!i)return!1;var n=getCookie("JSESSIONID").replace(/"/g,"");if(!n)return!1;var o=0==parseInt(e.getFriendPos)?1e5:1e3*parseInt(e.getFriendPos);GetFriendInterval=setInterval(function(){if(++GetFriendCount>=10)return clearInterval(GetFriendInterval),!1;chrome.storage.sync.get({getFriendPos:0},function(e){var t=parseInt(e.getFriendPos),i={count:40,sortType:"RECENTLY_ADDED",start:t};$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/connections",type:"get",data:i,headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":n,"x-restli-protocol-version":"2.0.0"},success:function(e){if(e){var i=[],n=e.included;0==n.length&&chrome.storage.sync.set({getFriend:!1},function(){clearInterval(GetFriendInterval)});for(var o=0;o<n.length;o++)if("com.linkedin.voyager.identity.shared.MiniProfile"==n[o].$type){var a={};a.entityUrn=n[o].entityUrn.split(":")[3],a.firstName=n[o].firstName,a.lastName=n[o].lastName,n[o].occupation?a.position=n[o].occupation.substr(0,140).replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,""):a.position="",n[o].picture&&n[o].picture.rootUrl&&n[o].picture.artifacts[0].fileIdentifyingUrlPathSegment?a.img=n[o].picture.rootUrl+n[o].picture.artifacts[0].fileIdentifyingUrlPathSegment:a.img="",a.publicId=n[o].publicIdentifier;for(var r=0;r<n.length;r++)if("com.linkedin.voyager.relationships.shared.connection.Connection"==n[r].$type&&n[r].entityUrn.split(":")[3]==a.entityUrn){n[r].createdAt?a.connected=parseInt(n[r].createdAt):a.connected="";break}i.push(a)}t+=40,chrome.storage.sync.set({getFriendPos:[t]},function(){});var i=JSON.stringify(i);chrome.runtime.sendMessage({action:"upload",type:"saveFriend",data:i,other:1},function(e){})}else clearInterval(GetFriendInterval)},error:function(){clearInterval(GetFriendInterval)}})})},o)})}function ShowFriendPage(){if(FriendPage){$("#j_friend_box").empty();$("#j_friend_box").append('<div class="j-explain-box j-w"><p>“好友”选项卡中只显示好友（1度人脉）</p><p style="color:#999;">若设置了搜索条件（关键词、所有地区、就读学校、目前就职），则会显示与此条件匹配的好友，每页10条；若没有设置任何条件，则会显示全部好友，每页显示40条。搜索出好友后可进行分组、群发消息、添加到禁发名单，挖掘等操作。</p><a href="http:linkedinjl.com/h" target="_black">查看详细使用说明</a></div>'),SearchFriend(),FriendPage=!1}}function SearchFriendEnter(e){13==e.keyCode&&chrome.storage.sync.get({account:"",my_urn:""},function(e){var t=String(e.account),i=String(e.my_urn);return t?i?(GetFriendData(1),$("#j_friend_keyword").css("pointer-events","none"),void setTimeout(function(){$("#j_friend_keyword").css("pointer-events","auto")},4e3)):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1):(CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1),!1)})}function ShowMoreCondition(){$(".j-more-condition-box").is(":hidden")?$("#j_more_condition_svg").addClass("j-svg-show"):$("#j_more_condition_svg").removeClass("j-svg-show"),$(".j-more-condition-box").slideToggle()}function SearchFriend(){chrome.storage.sync.get({account:"",my_urn:""},function(e){var t=String(e.account),i=String(e.my_urn);return t?i?(GetFriendData(1),$("#j_friend_search").css("pointer-events","none"),void setTimeout(function(){$("#j_friend_search").css("pointer-events","auto")},3e3)):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1):(CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号"),!1)})}function GetCondition(){var e=$.trim($.trim($("#j_friend_keyword").val())),t=$('input[name="country"]:checkbox:checked').length,i=$('input[name="company"]:checkbox:checked').length,n=$('input[name="school"]:checkbox:checked').length;return!!(e||t||i||n)}function ShowPaging(e,t,i,n){$("#"+e).empty();var o=Math.ceil(i/n);if(o>1){var a=t>2?t-2:1,r=t+2>o?o:t+2;1!=a&&$("#"+e).append('<a class="j-paging" title="首页">1</a>...');for(var s=a;s<=r;s++)s==t?$("#"+e).append('<input type="text" class="j-curpage" title="输入页码，按回车键，直接跳到相应页" value="'+s+'">'):$("#"+e).append('<a class="j-paging">'+s+"</a>");r!=o&&$("#"+e).append('...<a class="j-paging" title="未页">'+o+"</a>"),$("#"+e).css("display","block")}else $("#"+e).css("display","none")}function JumpFriend(e){if(13==e.keyCode){var t=parseInt($(this).val());if(!/^[1-9][0-9]*$/.test(t))return PointOut("请输入正确的页数",3),!1;var i=parseInt($("#j_friend_paging .j-paging:last").text());return t>i?(PointOut("请输入有效页数: 1 - "+i+" 范围内",3),!1):(GetFriendData(t),!0)}}function GetFriendSomePage(){GetFriendData(parseInt($(this).text()))}function GetFriendData(e){$("#j_more_condition_svg").removeClass("j-svg-show"),$(".j-more-condition-box").slideUp();var t=$.trim($.trim($("#j_friend_keyword").val())),i=$('input[name="country"]:checkbox:checked').length,n=$('input[name="company"]:checkbox:checked').length,o=$('input[name="school"]:checkbox:checked').length;t||i||n||o?GetFriendForSearch(e):chrome.storage.sync.get({numConnections:0},function(t){if(e>1){var i=parseInt(t.numConnections);GetFriendForAll(e,i)}else{var n=getCookie("JSESSIONID").replace(/"/g,"");if(!n)return PointOut("好友获取失败，请尝试刷新页面",1),!1;$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/connectionsSummary/",type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":n,"x-restli-protocol-version":"2.0.0"},success:function(t){if(t){var i=parseInt(t.data.numConnections);(new Date).getTime();chrome.storage.sync.set({numConnections:[i]},function(){GetFriendForAll(e,i)})}else PointOut("好友获取失败，请尝试刷新页面",3)},error:function(){PointOut("好友获取失败，请尝试刷新页面",3)}})}})}function GetFriendForSearch(e){var t=10*(e-1),i=getCookie("JSESSIONID").replace(/"/g,"");if(!i)return PointOut("好友获取失败，请尝试刷新页面",1),!1;var n=$.trim($.trim($("#j_friend_keyword").val())),o="",a="";$('input[name="country"]:checkbox:checked').each(function(){a+=$.trim($(this).val())+"|"}),a&&(a="geoRegion->"+a.substr(0,a.length-1),o+=","+encodeURIComponent(a));var r="";$('input[name="company"]:checkbox:checked').each(function(){r+=$.trim($(this).val())+"|"}),r&&(r="currentCompany->"+r.substr(0,r.length-1),o+=","+encodeURIComponent(r));var s="";$('input[name="school"]:checkbox:checked').each(function(){s+=$.trim($(this).val())+"|"}),s&&(s="school->"+s.substr(0,s.length-1),o+=","+encodeURIComponent(s));var c="https://www.linkedin.com/voyager/api/search/blended?count=10&filters=List(network-%3EF,resultType-%3EPEOPLE";c+=o+")&origin=FACETED_SEARCH&q=all&queryContext=List(spellCorrectionEnabled-%3Etrue)&start="+t,n&&(c+="&keywords="+n),chrome.storage.sync.get({my_urn:""},function(t){var n=String(t.my_urn);PointOut("获取好友中...",10),$.ajax({url:c,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":i,"x-restli-protocol-version":"2.0.0"},success:function(t){if($("#j_friend_search").css("pointer-events","auto"),t){PointOut("获取成功",1),$("#j_friend_box").empty(),$("#j_friend_tool").css("visibility","hidden");var i=t.data.paging.total;if(0==i){return $("#j_friend_box").append('<div class="j-explain-box j-w"><p style="text-align:center">没有匹配的好友,请切换搜索条件</p></div>'),ShowPaging("j_friend_paging",e,0,10),!1}var o=t.included;Friend=[];for(var a=0;a<o.length;a++)if("com.linkedin.voyager.identity.profile.MemberBadges"==o[a].$type)for(var r=0;r<o.length;r++)if("com.linkedin.voyager.identity.shared.MiniProfile"==o[r].$type&&o[a].entityUrn.split(":")[3]==o[r].entityUrn.split(":")[3]){var s={};s.entityUrn=o[r].entityUrn.split(":")[3],s.publicId=o[r].publicIdentifier,s.firstName=o[r].firstName,s.lastName=o[r].lastName,o[r].occupation?s.position=o[r].occupation.substr(0,140).replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,""):s.position="",o[r].picture&&o[r].picture.rootUrl&&o[r].picture.artifacts&&o[r].picture.artifacts[0].fileIdentifyingUrlPathSegment?s.img=o[r].picture.rootUrl+o[r].picture.artifacts[0].fileIdentifyingUrlPathSegment:s.img="",s.connected="",s.entityUrn!=n&&Friend.push(s);break}if(Friend){CurPos=Friend.length,$("#j_friend_tool").css("visibility","visible"),$("input[name='selectallfriend']").prop("checked",!1);for(var a=0;a<Friend.length;a++)AppendFriendToTable(Friend[a])}ShowPaging("j_friend_paging",e,i,10);var c=JSON.stringify(Friend);chrome.runtime.sendMessage({action:"upload",type:"saveFriend",data:c,other:0},function(e){})}else PointOut("好友获取失败，请尝试刷新页面",3)},error:function(){PointOut("好友获取失败，请尝试刷新页面",3)}})})}function GetFriendForAll(e,t){if(0==t){$("#j_friend_box").empty();return $("#j_friend_box").append('<div class="j-explain-box j-w"><p style="text-align:center">没有好友</p></div>'),!1}var i=40*(e-1),n=getCookie("JSESSIONID").replace(/"/g,"");if(!n)return!1;var o={count:40,sortType:"RECENTLY_ADDED",start:i};$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/connections",type:"get",data:o,headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":n,"x-restli-protocol-version":"2.0.0"},success:function(i){if(i){if(PointOut("获取成功",1),$("#j_friend_box").empty(),$("#j_friend_tool").css("visibility","hidden"),Friend=[],0==i.data.metadata.id)return chrome.storage.sync.set({getStatu:!1},function(){}),!1;for(var n=i.included,o=0;o<n.length;o++)if("com.linkedin.voyager.identity.shared.MiniProfile"==n[o].$type){var a={};a.entityUrn=n[o].entityUrn.split(":")[3],a.firstName=n[o].firstName,a.lastName=n[o].lastName,n[o].occupation?a.position=n[o].occupation.substr(0,140).replace(/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g,""):a.position="",n[o].picture&&n[o].picture.rootUrl&&n[o].picture.artifacts[0].fileIdentifyingUrlPathSegment?a.img=n[o].picture.rootUrl+n[o].picture.artifacts[0].fileIdentifyingUrlPathSegment:a.img="",a.publicId=n[o].publicIdentifier;for(var r=0;r<n.length;r++)if("com.linkedin.voyager.relationships.shared.connection.Connection"==n[r].$type&&n[r].entityUrn.split(":")[3]==a.entityUrn){n[r].createdAt?a.connected=parseInt(n[r].createdAt):a.connected="";break}Friend.push(a)}if(Friend.sort(function(e,t){return t.connected-e.connected}),Friend){CurPos=Friend.length,$("#j_friend_tool").css("visibility","visible"),$("input[name='selectallfriend']").prop("checked",!1);for(var o=0;o<Friend.length;o++)AppendFriendToTable(Friend[o])}ShowPaging("j_friend_paging",e,t,40);var s=JSON.stringify(Friend);chrome.runtime.sendMessage({action:"upload",type:"saveFriend",data:s,other:1},function(e){})}else PointOut("好友获取失败，请尝试刷新页面",3)},error:function(){PointOut("好友获取失败，请尝试刷新页面",3)}})}function AppendFriendToTable(e){var t=GetName(e.firstName,e.lastName),i='<div class="j-friend" id=f_'+e.entityUrn+'><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+e.publicId+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+e.img+'"></div></a><div class="j-profile" title="点击显示工具条"><h3>'+t+'</h3><p class="j-show j-position">'+e.position+'</p></div></div><div><input type="checkbox" name="friend"></div></div><div id="j_f_t_'+e.entityUrn+'" class="j-friend-toolbar"></div></div>';$("#j_friend_box").append(i),setTimeout(function(){chrome.runtime.sendMessage({action:"getFriendToolbar",urn:e.entityUrn},function(e){})},50)}function SelectAllFriend(){if($(this).prop("checked")){$("input[name='friend']").prop("checked",!0);var e=$("input[name='friend']:checkbox:checked").length;0==e?PointOut("没有可选",3):PointOut("选择了 "+e+" 位",1)}else $("input[name='friend']").prop("checked",!1)}function AddWhitelist(){if($("input[name='friend']:checkbox:checked").length>0){JlConfirm("确定要将选择的 "+$("input[name='friend']:checkbox:checked").length+" 位好友添加到禁发名单吗？","确定"),$("#j_ok").on("click",function(){var e=[];$("input[name='friend']:checkbox:checked").each(function(){var t=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41);e.push(t)});var e=JSON.stringify(e);chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:e,other:1,tag:"f"},function(e){})})}else PointOut("请选择要加入禁发名单的好友")}function UpdateWhitelistResult(e,t,i,n){switch(e){case 0:PointOut(t?"禁发名单添加失败":"禁发名单删除失败");break;case 1:if(t)switch(i){case"g":for(var o=0;o<n.length;o++)$("#g_"+n[o]).find(".j-updatewhitelist").removeClass("j-ico-whitelist-0"),$("#g_"+n[o]).find(".j-updatewhitelist").addClass("j-ico-whitelist-1"),$("#g_"+n[o]).find(".j-updatewhitelist").attr("title","已在禁发名单，点击移出");PointOut("已加入禁发名单",1);break;case"f":for(var o=0;o<n.length;o++)$("#f_"+n[o]).find(".j-updatewhitelist").removeClass("j-ico-whitelist-0"),$("#f_"+n[o]).find(".j-updatewhitelist").addClass("j-ico-whitelist-1"),$("#f_"+n[o]).find(".j-updatewhitelist").attr("title","已在禁发名单，点击移出");PointOut("已加入禁发名单",1);break;case"rightClick":GPointOut("已成功添加到禁发名单");break;default:PointOut("已加入禁发名单",1)}else{switch(i){case"g":for(var o=0;o<n.length;o++)$("#g_"+n[o]).find(".j-updatewhitelist").removeClass("j-ico-whitelist-1"),$("#g_"+n[o]).find(".j-updatewhitelist").addClass("j-ico-whitelist-0"),$("#g_"+n[o]).find(".j-updatewhitelist").attr("title","未在禁发名单，点击加入");break;case"f":for(var o=0;o<n.length;o++)$("#f_"+n[o]).find(".j-updatewhitelist").removeClass("j-ico-whitelist-1"),$("#f_"+n[o]).find(".j-updatewhitelist").addClass("j-ico-whitelist-0"),$("#f_"+n[o]).find(".j-updatewhitelist").attr("title","未在禁发名单，点击加入");break;case"whitelist":var a=$.trim($("#j_whitelist_keyword").val()),r=parseInt($("#j_whitelist_paging .j-curpage").val())||1,s=parseInt($("#j_whitelist_paging .j-paging:last").text())||1;r=r>s?s:r,GetWhitelist(r,20,a)}PointOut("已移出禁发名单",1)}break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}}function ShowFriendToolbar(){if(0==$(this).parent().parent().next().children().is(":visible")){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41);chrome.runtime.sendMessage({action:"getFriendToolbar",urn:e},function(e){}),chrome.runtime.sendMessage({action:"showRemark",friend:e,tag:"f"},function(){})}else{var t=$(this).find(".j-position");t.removeClass("j-hide"),t.addClass("j-show"),$(this).find(".j-remarks").remove(),$(this).parent().parent().next().slideToggle(200)}}function GetFriendToolbarResult(e,t){switch(e){case 0:break;case 1:if(t){if($("#j_f_t_"+t.entityUrn).empty(),1!=t.is_dig){t.is_dig=0;var i="未挖掘，点击挖掘"}else var i="已挖掘, 点击查看详情";if(1!=t.is_whitelist){t.is_whitelist=0;var n="添加到禁发名单"}else var n="已在禁发名单，点击移出";t.send_time>315504e6?t.send_time="群发："+new Date(t.send_time).Format("yyyy-MM-dd"):t.send_time="未群发过",t.group_name?$("#f_"+t.entityUrn).addClass("j-has-grouping"):t.group_name="未分组";var o='<div class="j-nowrap"><div class="j-senddate" title="最近一次群发日期">'+t.send_time+'</div><div class="j-senddate" title="分组">'+t.group_name+'</div><div class="j-nowrap j-edit-tool"><div class="j-ico-bg"><div class="j-ico j-ico-edit j-friend-edit" title="修改备注"></div></div><div class="j-ico-bg"><div class="j-ico j-dig j-ico-dig-'+t.is_dig+'" title='+i+'></div></div><div class="j-ico-bg"><div class="j-ico j-updatewhitelist j-ico-whitelist-'+t.is_whitelist+'" title='+n+"></div></div></div></div>";$("#j_f_t_"+t.entityUrn).append(o),$("#j_f_t_"+t.entityUrn).slideToggle(200)}break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}}function StartFriendSendMsg(){chrome.storage.sync.get({run:!1,s_today_num:0,s_limit:100,level:0},function(e){if(e.run)return PointOut("正在批量操作中，请先停止操作，再进行群发消息"),!1
;if(parseInt(e.level)<1&&parseInt(e.s_today_num)>=10)return ShowDiff("今天群发名额已用完","普通会员每天可群发10条，若要发送更多，请升级VIP会员使用，谢谢支持！"),!1;if(parseInt(e.s_today_num)>=parseInt(e.s_limit))return PointOut("今日累计发送 "+parseInt(e.s_today_num)+"条消息，超过每日最多发送量，请明天再来发送或将每日最多发送量设置大些。"),!1;if($("input[name='friend']:checkbox:checked").length>0){JlConfirm("选择了好友不自动翻页，确定仅给选择的 "+$("input[name='friend']:checkbox:checked").length+" 位好友群发消息吗？","确定"),$("#j_ok").on("click",function(){Friend=[],$("input[name='friend']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)});var e={tag:"friendSelect",groupId:""};chrome.runtime.sendMessage({action:"getAllTidings",tag:e},function(e){})})}else JlConfirm("确定从此页开始群发消息吗？会自动翻页","确定"),$("#j_ok").on("click",function(){Friend=[],$("input[name='friend']").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)});var e={tag:"friendAll",groupId:""};chrome.runtime.sendMessage({action:"getAllTidings",tag:e},function(e){})})})}function StartFriendDigForBatch(){chrome.storage.sync.get({run:!1,d_today_num:0,d_limit:100},function(e){return e.run?(PointOut("正在批量操作中，请先停止操作，再进行批量挖掘"),!1):parseInt(e.d_today_num)>=parseInt(e.d_limit)?(PointOut("今日累计挖掘 "+parseInt(e.d_today_num)+"条，超过每日最多挖掘量，请明天再来挖掘或将每日最多挖掘量设置大些。"),!1):$("input[name='friend']:checkbox:checked").length>0?(JlConfirm("确定挖掘选择的 "+$("input[name='friend']:checkbox:checked").length+" 位好友资料吗？","确定"),void $("#j_ok").on("click",function(){Friend=[],$("input[name='friend']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),CurPos=Friend.length,ActionCount=0,ShowStatu("批量挖掘..."),DigFriendForBatch("noLoop")})):(PointOut("请选择要挖掘的好友"),!1)})}function StartGroupingForFriend(){chrome.storage.sync.get({level:0,regTime:0},function(e){var t=parseInt(e.regTime)+2592e5,i=(new Date).getTime();if(parseInt(e.level)<2&&i>t)return ShowDiff("非钻石会员不支持分组功能","非钻石会员分组功能可试用3天，您的试用期已过，请升级钻石会员使用"),!1;if($("input[name='friend']:checkbox:checked").length>0){$("input[name='friend']:checkbox:checked").length;Friend=[],$("input[name='friend']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),chrome.runtime.sendMessage({action:"getGroup",tag:"addGroup",groupId:""},function(e){})}else PointOut("请选择要分组的好友")})}function ShowGroupingDialog(e){for(var t='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>选择分组</h3></div></div><div class="j-prompt-cont"><div class="j-new-group-box"><div><span>组名：</span></div><div><select id="j_select_group" style="padding:6px">',i=0;i<e.length;i++)t+="<option value="+e[i].groupId+">"+e[i].groupName+"</option>";t+='</select></div><div><span>备注：</div><div></span><textarea id="j_friend_remarks" class="j-group-desc" placeholder="请输入好友备注(选填，最多100个字符)" maxlength=100></textarea></div></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_add_group" class="j-bg-btn j-layout-btn">确定</button></div></div></div>',$("#lyjl").append(t),$(".j-dialog").fadeIn(200),$("#j_add_group").on("click",function(){var e=$.trim($("#j_select_group").val()),t=$.trim($("#j_friend_remarks").val()),i=JSON.stringify(Friend),n=JSON.stringify({groupId:e,remarks:t});chrome.runtime.sendMessage({action:"upload",type:"groupingForBatch",data:i,other:n},function(e){})})}function GroupingForBatchResult(e){switch(e){case 0:PointOut("分组失败");break;case 1:PointOut("分组成功"),$(".j-dialog").remove();break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("分组失败")}}function CleanCondition(){CleanSelectCountry(),CleanSelectCompany(),CleanSelectSchool(),PointOut("清除完成",1)}function GetSearchCountry(){var e=$.trim($(this).val()),t=getCookie("JSESSIONID").replace(/"/g,"");$("#j_select_country").empty();var i="urn:li:page:d_flagship3_search_srp_people;"+randomString(22)+"==";if(e&&t){if(isChinese(e))var n="zh_CN";else var n="en_US";var o={keywords:e,origin:"OTHER",q:"type",type:"REGION"};$.ajax({url:"https://www.linkedin.com/voyager/api/typeahead/hitsV2",data:o,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"x-li-lang":n,"x-restli-protocol-version":"2.0.0","x-li-page-instance":i},success:function(e){if(e){var t=e.data.elements,i=t.length;if(i>0)for(var n=0;n<i;n++){var o=t[n].targetUrn.slice(18).replace(")","").replace(",",":"),a=t[n].text.text,r='<div><span class="j-country-span" urn="'+o+'">'+a+"</span></div>";$("#j_select_country").append(r)}}},error:function(){PointOut("获取国家错误")}})}}function ShowOrHideSearch(){$(this).next().is(":visible")?$(this).next().slideUp(200):($(".j-condition").slideUp(0),$(this).next().slideDown(200))}function SelectCountry(){var e=$.trim($(this).attr("urn")),t=$(this).text();$(this).parent("div").remove(),$('input[name="country"]').each(function(){if($.trim($(this).val())==e)return $(this).parent("li").remove(),!0});var i='<li><input type="checkbox" name="country" checked="checked" value="'+e+'"><span>'+t+"</span></li>";$("#j_country").append(i)}function CleanSelectCountry(){$("#j_country").empty();$("#j_country").append('<li><input type="checkbox" name="country" value="cn:0"><span>中国</span></li><li><input type="checkbox" name="country" value="cn:8910"><span>中国 广东 深圳</span></li>'),$("#j_condition_country span").text("所在地区"),PointOut("清除完成",1)}function DetermineSelectCountry(){var e=$('input[name="country"]:checkbox:checked').length;e>0?($('input[name="country"]').each(function(){$(this).prop("checked")||$(this).parent("li").remove()}),$("#j_condition_country span").text("所在地区("+e+")")):$("#j_condition_country span").text("所在地区"),$(".j-condition").slideUp(200),$("#j_search_country").val(""),$("#j_select_country").empty()}function GetSearchCompany(){var e=$.trim($(this).val()),t=getCookie("JSESSIONID").replace(/"/g,"");$("#j_select_company").empty();var i="urn:li:page:d_flagship3_search_srp_people;"+randomString(22)+"==";if(e&&t){var n={keywords:e,origin:"OTHER",q:"type",type:"COMPANY"};$.ajax({url:"https://www.linkedin.com/voyager/api/typeahead/hitsV2",data:n,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"x-restli-protocol-version":"2.0.0","x-li-page-instance":i},success:function(e){if(e){var t=e.data.elements,i=t.length;if(i>0)for(var n=0;n<i;n++){var o=t[n].targetUrn.slice(18),a=t[n].text.text,r='<div><span class="j-company-span" urn="'+o+'">'+a+"</span></div>";$("#j_select_company").append(r)}}},error:function(){PointOut("获取公司信息出错")}})}}function SelectCompany(){var e=$.trim($(this).attr("urn")),t=$(this).text();$(this).parent("div").remove(),$('input[name="company"]').each(function(){if($.trim($(this).val())==e)return $(this).parent("li").remove(),!0});var i='<li><input type="checkbox" name="company" checked="checked" value="'+e+'"><span>'+t+"</span></li>";$("#j_company").append(i)}function CleanSelectCompany(){$("#j_company").empty();$("#j_company").append('<li><input type="checkbox" name="company" value="14160"><span>阿里巴巴</span></li><li><input type="checkbox" name="company" value="3014"><span>华为</span></li>'),$("#j_condition_company span").text("目前就职"),PointOut("清除完成",1)}function DetermineSelectCompany(){var e=$('input[name="company"]:checkbox:checked').length;e>0?($('input[name="company"]').each(function(){$(this).prop("checked")||$(this).parent("li").remove()}),$("#j_condition_company span").text("目前就职("+e+")")):$("#j_condition_company span").text("目前就职"),$(".j-condition").slideUp(200),$("#j_search_company").val(""),$("#j_select_company").empty()}function GetSearchSchool(){var e=$.trim($(this).val()),t=getCookie("JSESSIONID").replace(/"/g,"");$("#j_select_school").empty();var i="urn:li:page:d_flagship3_search_srp_people;"+randomString(22)+"==";if(e&&t){var n={keywords:e,origin:"OTHER",q:"type",type:"SCHOOL"};$.ajax({url:"https://www.linkedin.com/voyager/api/typeahead/hitsV2",data:n,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"x-restli-protocol-version":"2.0.0","x-li-page-instance":i},success:function(e){if(e){var t=e.data.elements,i=t.length;if(i>0)for(var n=0;n<i;n++){var o=t[n].targetUrn.slice(21),a=t[n].text.text,r='<div><span class="j-school-span" urn="'+o+'">'+a+"</span></div>";$("#j_select_school").append(r)}}},error:function(){PointOut("获取就读学校错误")}})}}function SelectSchool(){var e=$.trim($(this).attr("urn")),t=$(this).text();$(this).parent("div").remove(),$('input[name="school"]').each(function(){if($.trim($(this).val())==e)return $(this).parent("li").remove(),!0});var i='<li><input type="checkbox" name="school" checked="checked" value="'+e+'"><span>'+t+"</span></li>";$("#j_school").append(i)}function CleanSelectSchool(){$("#j_school").empty();$("#j_school").append('<li><input type="checkbox" name="school" value="11287"><span>北京大学</span></li><li><input type="checkbox" name="school" value="11398"><span>清华大学</span></li>'),$("#j_condition_school span").text("就读学校"),PointOut("清除完成",1)}function DetermineSelectSchool(){var e=$('input[name="school"]:checkbox:checked').length;e>0?($('input[name="school"]').each(function(){$(this).prop("checked")||$(this).parent("li").remove()}),$("#j_condition_school span").text("就读学校("+e+")")):$("#j_condition_school span").text("就读学校"),$(".j-condition").slideUp(200),$("#j_search_school").val(""),$("#j_select_school").empty()}function GroupForRight(e,t){switch(e){case 0:GPointOut("获取分组失败");break;case 1:var i=Fid;if(!i)return GPointOut("没选择好友，请将鼠标移到好友头像上",3),!1;if(1!=Dist)return GPointOut("非好友不可分组",3),!1;for(var n='<div id="j_statu_dialog" class="j-gdialog"><div class="j-group-select-box j-div-center j-box-sha"><div class="j-dialog-title j-bg2"><h3>选择分组</h3></div><div id="j_friend_profile" class="j-group-detail"></div><div class="j-group-cont">分组到：<select id="j_group_id" style="width:200px; padding:6px;">',o=t.length,a=0;a<o;a++)n+='<option value="'+t[a].groupId+'">'+t[a].groupName+"</option>";n+='</select></div><div class="j-group-cont"><textarea id="j_group_desc" style="width:300px;height:62px;padding:6px;" placeholder="请输入关于好友备注(选填)"></textarea></div><div class="j-group-cont"><button class="j-bg-btn j-layout-btn j-open-dialog" style="margin:6px;">取消</button><button id="j_ok" class="j-bg-btn j-layout-btn" style="margin:6px;">确认</button></div></div></div>',$("body").append(n),$(".j-gdialog").fadeIn(200),chrome.runtime.sendMessage({action:"getFriendGroupRight",publicid:i},function(e){}),$(".j-open-dialog").on("click",function(){$(".j-gdialog").remove()}),$("#j_ok").on("click",function(){var e=$.trim($("#j_group_id").val());if(!e)return GPointOut("请选择分组"),!1;var t=$.trim($("#j_group_desc").val()),i=[],n={};if(n.entityUrn=$.trim($("#j_friend_name").attr("urn")),!n.entityUrn)return GPointOut("分组失败"),!1;i.push(n);var i=JSON.stringify(i),o=JSON.stringify({groupId:e,remarks:t});chrome.runtime.sendMessage({action:"upload",type:"groupingForBatch",data:i,other:o},function(e){}),$(".j-gdialog").remove()});break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:confirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？")&&BindLinkedin(!0);break;default:GPointOut("获取分组失败")}}function GetFriendGroupRightResult(e,t){switch(e){case 0:GPointOut("分组失败"),$(".j-gdialog").remove();break;case 1:var i=t.img||"http://linkedinjl.com/expand/version8/img/me.png",n=GetName(t.firstName,t.lastName),o='<div style="display: flex; justify-content: flex-star;"><div class="head-img-box"><img src="'+i+'"></div><div style="margin:auto 0px;"><h3 style="color:#000;" id="j_friend_name" urn="'+t.entityUrn+'">'+n+"</h3><p>"+t.position+"</p></div></div>";$("#j_friend_profile").append(o),$("#j_group_desc").val(t.remarks);break;case 2:alert("没有登录领英精灵，请在领英精灵界面登录领英精灵账号"),$(".j-gdialog").remove();break;case 3:alert("没有绑定Linkedin账号，请先绑定Linkedin账号"),$(".j-gdialog").remove();break;case 4:var a=getCookie("JSESSIONID").replace(/"/g,"");if(!a)return PointOut("添加失败",1),!1;var r="https://www.linkedin.com/voyager/api/identity/profiles/"+t+"/profileView";$.ajax({url:r,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":a,"x-restli-protocol-version":"2.0.0"},success:function(e){var i=e.included,n=[];if(i)for(var o=0;o<i.length;o++)if("com.linkedin.voyager.identity.shared.MiniProfile"==i[o].$type){var a=i[o],r={};r.publicId=t,a&&a.firstName?r.firstName=a.firstName:r.firstName="",a&&a.lastName?r.lastName=a.lastName:r.lastName="",a&&a.occupation?r.position=a.occupation.substr(0,120):r.position="",a&&a.picture&&a.picture.rootUrl&&a.picture.artifacts&&a.picture.artifacts[0].fileIdentifyingUrlPathSegment?r.img=a.picture.rootUrl+a.picture.artifacts[0].fileIdentifyingUrlPathSegment:r.img="",a&&a.entityUrn?r.entityUrn=a.entityUrn.split(":")[3]:r.entityUrn=null,n.push(r)}var s=JSON.stringify(n);chrome.runtime.sendMessage({action:"upload",type:"saveFriend",data:s,other:0},function(e){});var c=GetName(n[0].firstName,n[0].lastName),d=n[0].img||"http://linkedinjl.com/expand/version8/img/me.png",l='<div style="display: flex; justify-content: flex-star;"><div class="head-img-box"><img src="'+d+'"></div><div style="margin:auto 0px;"><h3 style="color:#000;" id="j_friend_name" urn="'+n[0].entityUrn+'">'+c+"</h3><p>"+n[0].position+"</p></div></div>";$("#j_friend_profile").append(l)},error:function(){GPointOut("分组失败"),$(".j-gdialog").remove()}});break;default:GPointOut("分组失败"),$(".j-gdialog").remove()}}function ShowGroupPage(){$("#j_group_box").empty();$("#j_group_box").append('<div class="j-explain-box j-w"><p>分组功能可对Linkedin好友进行分组、备注，实现高效管理好友。</p><p style="color:#999;">若搜索框中没有关键词会显示全部已分组的好友；若设置有关键词只会显示与此关键词匹配的已分组好友，关键词只匹配姓、名、职位、备注。</p><a href="http:linkedinjl.com/h?o=group" target="_black">查看详细使用说明</a></div>'),GetGroup()}function GetGroupEnter(e){13==e.keyCode&&GetGroup()}function GetGroup(){chrome.storage.sync.get({account:"",my_urn:"",level:0,regTime:0},function(e){var t=String(e.account),i=String(e.my_urn);if(!t)return PointOut("请先登录领英精灵账号",3),CreatLoginDialog(),!1;if(!i)return JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1;var n=parseInt(e.regTime)+2592e5,o=(new Date).getTime();if(parseInt(e.level)<2&&o>n){$("#j_group_box").empty();return $("#j_group_box").append('<div class="j-explain-box j-w"><p>分组功能可对Linkedin好友进行分组、备注，实现高效管理好友。</p><p style="color:#999;">若搜索框中没有关键词会显示全部已分组的好友；若设置有关键词只会显示与此关键词匹配的已分组好友。关键词只匹配姓、名、职位、备注</p><p style="color:#f00; padding:6px; text-align:center;">非钻石会员分组功能可试用3天，您的试用期已过，请升级钻石会员使用<a class="j-upvip">前往升级</a></p></div>'),ShowDiff("非钻石会员不支持分组功能","非钻石会员分组功能可试用3天，您的试用期已过，请升级钻石会员使用"),!1}chrome.runtime.sendMessage({action:"getGroup",tag:"showGroup",groupId:""},function(e){})})}function GetGroupResult(e,t,i,n){switch(e){case 0:PointOut("分组获取失败，请尝试刷新页面或重启浏览器");break;case 1:switch(i){case"showGroup":if(t){$("#j_group_box").empty(),PointOut("获取分组完成",1);for(var o=0;o<t.length;o++)AppendGroupToTable(t[o])}else{$("#j_group_box").empty();$("#j_group_box").append('<div class="j-explain-box j-w"><p>分组功能可对Linkedin好友进行分组、备注，实现高效管理好友。</p><p style="color:#999;">若搜索框中没有关键词会显示全部已分组的好友；若设置有关键词只会显示与此关键词匹配的已分组好友，关键词只匹配姓、名、职位、备注。</p><a href="http:linkedinjl.com/h?o=group" target="_black">查看详细使用说明</a></div>')}break;case"moveGroupForBatch":t?ShowMoveGroupForBatch(t,n):(PointOut("没有分组，请先创建分组"),NewGroup());break;case"addGroup":t?ShowGroupingDialog(t):(PointOut("没有分组，请先创建有"),NewGroup());break;case"sortGroup":t?SortGroup(t):PointOut("没有分组，请先创建分组");break;default:PointOut("分组获取失败，请尝试刷新页面或重启浏览器")}break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("分组获取失败，请尝试刷新页面或重启浏览器")}}function AppendGroupToTable(e){var t='<div><div class="j-group-box j-group-box-not-active j-nowrap" groupid='+e.groupId+'><div class="j-group j-nowrap-left" title='+e.remarks+'><div class="j-group-edit-box"><div class="j-svg-group"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="width:12px;height:12px;"><polyline stroke="#666" points="0 2, 6 8, 12 2" style="fill:none;stroke-width:1" /></svg></div><div class="j-group-edit j-bg-w j-box-sha"><ul style="list-style-type:none;"><li><button class="j-edit-group">修改分组</button></li><li><button class="j-sort">分组排序</button></li><li><button class="j-delete-group">删除分组</button></li></ul></div></div><div ><span>'+e.groupName+'</span><span id="j_gnum_'+e.groupId+'" class="j-group-num" style="margin-left:6px;"></span></div></div><div class="j-group-tool"><div style="display: flex; justify-content:flex-end;">';t+='<div class="j-ico-bg"><div class="j-ico j-ico-group j-movegroup" title="移动到"></div></div><div class="j-ico-bg"><div class="j-ico j-ico-delete j-friend-delete" title="将好友移出该分组"></div></div><div class="j-ico-bg" style="margin-left:6px;"><div class="j-ico j-ico-dig j-group-dig" title="挖掘组内好友资料"></div></div><div class="j-ico-bg"><div class="j-ico j-ico-sendmsg j-group-send" title="群发消息" groupid=></div></div><div class="j-ico-bg"><div class="j-ico j-ico-whitelist" title="批量添加到禁发名单"></div></div><div style="margin-top:4px; margin-left:12px; text-align:center;"><input class="j-gall" type="checkbox" title="全选/全不选"/></div></div></div></div><div class="j-g-detail" id="j_g_detail_'+e.groupId+'"></div></div>',$("#j_group_box").append(t);var i=$.trim($("#j_group_keyword").val());GetGroupFriend(e.groupId,0,10,i)}function ShowGroupDetail(){$(".j-group-box").addClass("j-group-box-not-active"),$(".j-group-box").removeClass("j-group-box-active"),$(".j-group-tool").css("display","none"),$(".j-g-detail").slideUp(200),$(".j-svg-group").removeClass("j-svg-show"),0==$(this).parent().next().is(":visible")&&($(this).parent().addClass("j-group-box-active"),$(this).parent().removeClass("j-group-box-not-active"),$(this).next().css("display","block"),$(this).find(".j-svg-group").addClass("j-svg-show"),$(this).parent().next().slideDown(200))}function GetGroupFriend(e,t,i,n){chrome.runtime.sendMessage({action:"getGroupFriend",groupId:e,start:t,count:i,keyword:n},function(e){})}function GetGroupFriendResult(e,t,i,n,o){switch(e){case 0:break;case 1:if($("#j_gnum_"+t).text("("+n+")"),0==n)return $("#j_g_detail_"+t).empty(),$("#j_g_detail_"+t).append('<div style="text-align:center; padding:12px;">该分组没有好友</div>'),!1;for(var a=0;a<i.length;a++)AppendGroupFriend(t,i[a],n,o);setTimeout(function(){o>=n?$("#j_g_detail_"+t).append('<div style="text-align:center; padding:12px;">到底了，没有更多</div>'):$("#j_g_detail_"+t).append('<div class="j-load-more j-load-friend" groupid='+t+" start="+o+">加载更多</div>")},50);break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}}function NewGroup(){chrome.storage.sync.get({account:"",my_urn:"",level:0,regTime:0},function(e){var t=String(e.account),i=String(e.my_urn);if(!t)return CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1),!1;if(!i)return JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),void $("#j_ok").on("click",function(){BindLinkedin(!0)});var n=parseInt(e.regTime)+2592e5,o=(new Date).getTime();if(parseInt(e.level)<2&&o>n)return ShowDiff("非钻石会员不支持分组功能","非钻石会员分组功能可试用3天，您的试用期已过，请升级钻石会员使用"),!1;$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>新增分组</h3></div></div><div class="j-prompt-cont"><div class="j-new-group-box"><div><span>组名：</span></div><div><input id="j_group_name" type="text" placeholder="请输入分组名（必填，最多8个字符）" maxlength=8 autofocus="autofocus"></div><div><span>备注：</div><div></span><textarea id="j_group_remark" class="j-group-desc" placeholder="请输入分组备注(选填，最多100个字符)" maxlength=100></textarea></div></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_new_group" class="j-bg-btn j-layout-btn">确定新增</button></div></div></div>'),$(".j-dialog").fadeIn(200)})}function SaveNewGroup(){var e=$.trim($("#j_group_name").val()),t=$.trim($("#j_group_remark").val());if(!e)return PointOut("分组名不能为空"),void $("#j_group_name").focus();var i=String((new Date).getTime()),n={groupId:i,groupName:e,remarks:t};n=JSON.stringify(n),chrome.runtime.sendMessage({action:"upload",type:"saveNewGroup",data:n,other:"新增"},function(e){})}function SaveNewGroupResult(e,t){switch(e){case 0:PointOut("分组"+t+"失败");break;case 1:PointOut("分组"+t+"成功"),$(".j-dialog").remove();break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("分组"+t+"失败")}}function DeleteGroup(){var e=$.trim($(this).parents(".j-group").find("span:first").text()),t=$.trim($(this).parents(".j-group-box").attr("groupid"));JlConfirm('确定要删除 "'+e+'" 分组吗?',"确定"),$("#j_ok").on("click",function(){chrome.runtime.sendMessage({action:"upload",type:"deleteGroup",data:t,other:""},function(e){})})}function DeleteGroupResult(e){switch(e){case 0:PointOut("分组删除失败");break;case 1:PointOut("分组删除成功");break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("分组删除失败")}}function ReviseGroup(){var e=$.trim($(this).parents(".j-group-box").attr("groupid"));chrome.runtime.sendMessage({action:"getAGroup",groupId:e},function(e){})}function GetAGroupResult(e,t){switch(e){case 0:PointOut("分组修改失败");break;case 1:ShowReviseGroupDialog(t);break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("分组修改失败")}}function ShowReviseGroupDialog(e){var t='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>修改分组</h3></div></div><div class="j-prompt-cont"><div class="j-new-group-box"><div><span>组名：</span></div><div><input id="j_group_name" type="text" placeholder="请输入分组名（必填，最多8个字符）" groupid="'+e.groupId+'" value="'+e.groupName+'" maxlength=8 autofocus="autofocus"></div><div><span>备注：</div><div></span><textarea id="j_group_remark" class="j-group-desc" placeholder="请输入分组备注(选填，最多100个字符)" maxlength=100>'+e.remarks+'</textarea></div></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_revise_group" class="j-bg-btn j-layout-btn">确定修改</button></div></div></div>';$("#lyjl").append(t),$(".j-dialog").fadeIn(200)}function SaveReviseGroup(){var e=$.trim($("#j_group_name").val()),t=$.trim($("#j_group_remark").val());if(!e)return PointOut("分组名不能为空"),void $("#j_group_name").focus();var i=$.trim($("#j_group_name").attr("groupid")),n={groupId:i,groupName:e,remarks:t};n=JSON.stringify(n),chrome.runtime.sendMessage({action:"upload",type:"saveNewGroup",data:n,other:"修改"},function(e){})}function StartSortGroup(){chrome.runtime.sendMessage({action:"getGroup",tag:"sortGroup",groupId:""},function(e){})}function SortGroup(e){$(".j-dialog").remove();for(var t='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-bg-w j-box-sha"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>分组排序</h3></div></div><div class="j-prompt-cont"><div class="j-w j-sort-group-box">',i=0;i<e.length;i++)t+='<div class="j-sort-group j-nowrap" groupid='+e[i].groupId+"><div><p>"+e[i].groupName+'</p></div><div class="j-nowrap"><div class="j-ico-bg"><div class="j-ico j-ico-up" title="上移"></div></div><div class="j-ico-bg"><div class="j-ico j-ico-down" title="下移"></div></div></div></div>';t+='</div></div><div class="j-prompt-ctrl"><button id="j_cancel" class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_ok" class="j-bg-btn j-layout-btn">确定</button></div></div></div>',$("#lyjl").append(t),$(".j-dialog").fadeIn(0),$("#j_ok").on("click",function(){var e=[],t=$(".j-sort-group").length;$(".j-sort-group").each(function(){var i={};i.groupId=$.trim($(this).attr("groupid")),i.sort=t,t--,e.push(i)}),e=JSON.stringify(e),chrome.runtime.sendMessage({action:"upload",type:"saveSortGroup",data:e,other:""},function(e){}),GetGroup(),RemoveDialog()})}function SortUp(){var e=$(this).parents(".j-sort-group");0!=e.index()?(e.prev().before(e),PointOut("上移",1)):PointOut("第一个，无法上移",1)}function SortDown(){var e=$(this).parents(".j-sort-group"),t=$(".j-sort-group").length;e.index()!=t-1?(e.next().after(e),PointOut("下移",1)):PointOut("最后一个，无法下移",1)}function AppendGroupFriend(e,t,i,n){if(t.img||(t.img="http://linkedinjl.com/expand/version7/img/me.png"),1!=t.is_dig){t.is_dig=0;var o="未挖掘，点击挖掘"}else var o="已挖掘，点击查看详情";if(1!=t.is_whitelist){t.is_whitelist=0;var a="未在禁发名单，点击加入"}else var a="已在禁发名单，点击移出";t.send_time>3155041e5?t.send_time="群发："+new Date(t.send_time).Format("yyyy-MM-dd"):t.send_time="未群发过";var r=GetName(t.firstname,t.lastname),s='<div class="j-friend" id=g_'+t.friend_urn+'><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+t.public_id+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+t.img+'"></div></a><div class="j-profile" title="点击显示工具条"><h3>'+r+'</h3><p class="j-show j-position">'+t.position+'</p></div></div><div><input type="checkbox" name=g_'+e+'></div></div><div class="j-friend-toolbar"><div class="j-nowrap"><div class="j-senddate" title="最近一次群发日期">'+t.send_time+'</div><div class="j-nowrap j-edit-tool"><div class="j-ico-bg"><div class="j-ico j-ico-edit j-friend-edit" title="修改备注"></div></div><div class="j-ico-bg"><div class="j-ico j-dig j-ico-dig-'+t.is_dig+'" title='+o+'></div></div><div class="j-ico-bg"><div class="j-ico j-updatewhitelist j-ico-whitelist-'+t.is_whitelist+'" title='+a+"></div></div></div></div></div></div>";$("#j_g_detail_"+e).append(s)}function LoadMoreGroupFriend(){var e=$(this).attr("groupid"),t=parseInt($(this).attr("start")),i=$.trim($("#j_group_keyword").val());$(this).remove(),GetGroupFriend(e,t,100,i)}function SelectAllGroupFriend(){var e=$.trim($(this).parents(".j-group-box").attr("groupid"));if($(this).prop("checked")){$("input[name='g_"+e+"']").prop("checked",!0);var t=$("input[name='g_"+e+"']:checkbox:checked").length;0==t?PointOut("该分组中没有可选好友",1):PointOut("选择了 "+t+" 位好友",1)}else $("input[name='g_"+e+"']").prop("checked",!1)}function ShowMoreEdit(){if(0==$(this).parent().parent().next().children().is(":visible")){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41);chrome.runtime.sendMessage({action:"showRemark",friend:e,tag:"g"},function(){})}else{var t=$(this).find(".j-position");t.removeClass("j-hide"),t.addClass("j-show"),$(this).find(".j-remarks").remove()}$(this).parent().parent().next().slideToggle(200)}function StartGroupSendMsg(){var e=$.trim($(this).parents(".j-group-box").attr("groupid")),t=$(this).parents(".j-group-tool").prev().find("span:first").text();chrome.storage.sync.get({run:!1,s_today_num:0,s_limit:100,level:0},function(i){if(i.run)return PointOut("正在批量操作中，请先停止操作，再进行组内群发"),!1;if(parseInt(i.level)<1&&parseInt(i.s_today_num)>=10)return ShowDiff("今天群发名额已用完","普通会员每天可群发10条，若要发送更多，请升级VIP会员使用，谢谢支持！"),!1;if(parseInt(i.s_today_num)>parseInt(i.s_limit))return PointOut("今日累计发送 "+parseInt(i.s_today_num)+" 条消息，超过每日最多发送量，请明天再来发送或将每日最多发送量设置大些。"),!1;var n=$("input[name='g_"+e+"']").length;if(0==n)return PointOut("该分组中没有好友",3),!1;n=$("input[name='g_"+e+"']:checkbox:checked").length,0==n?(JlConfirm('确定要给 "'+t+'" 分组所有好友群发消息吗？'),$("#j_ok").on("click",function(){var t={tag:"groupAll",groupId:e};chrome.runtime.sendMessage({action:"getAllTidings",tag:t},function(e){})})):(Friend=[],$("input[name='g_"+e+"']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),JlConfirm("确定要给选择的 "+n+" 位好友群发消息吗？"),$("#j_ok").on("click",function(){var e={tag:"groupSelect",groupId:""};chrome.runtime.sendMessage({action:"getAllTidings",tag:e},function(e){})}))})}function GetAllTidingsResult(e,t,i){switch(e){case 0:PointOut("获取消息失败，请尝试刷新页面或重启浏览器");break;case 1:CreatTidingsDialog(t,i);break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("获取消息失败，请尝试刷新页面或重启浏览器")}}function CreatTidingsDialog(e,t){$(".j-dialog").remove();var i='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-bg-w j-box-sha"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-warn"></div><h3>选择要群发的消息内容</h3></div></div><div class="j-prompt-cont"><div id="j_newtidings" tag='+t.tag+" groupid="+t.groupId+'><p title="新增消息内容">+新增消息内容</p></div><div id="j_tidings_box">';if(e&&e.length>0){i+='<table class="j-tab-tidings j-tab"><tbody>';for(var n=0;n<e.length;n++)i+='<tr tidings_id="'+e[n].tidings_id+'">',1==e[n].is_select?i+='<td><input type="checkbox" name="tidings" checked=true></td>':i+='<td><input type="checkbox" name="tidings"></td>',i+='<td title="双击修改内容"><div>'+e[n].tidings+'</div></td><td><div class="j-ico-bg"><div class="j-ico j-ico-delete j-delete-tidings" title="删除消息"></div></div></td></tr>';i+="</tbody></table>"}else i+='<div class="j-explain-box j-w"><p>群发前请设置要群发的消息内容，请遵守领英规则，不要滥用群发功能。建议多设置几条，群发时会从选择的消息里随机发送一条。</p><a href="http:linkedinjl.com/h?o=sendmsg" target="_black">查看详细使用说明</a></div>';i+='</div></div><div class="j-prompt-ctrl"><button id="j_cancel" class="j-bg-btn j-layout-btn">取消</button><button id="j_startsend" class="j-bg-btn j-layout-btn">开始群发</button></div></div></div>',setTimeout(function(){$("#lyjl").append(i),$(".j-dialog").fadeIn(100),$("#j_newtidings").on("click",function(){NewTidings(t)}),$("#j_cancel").on("click",function(){$(".j-dialog").remove()})},50)}function NewTidings(e){$(".j-dialog").remove();$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-bg-w j-box-sha"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>新增消息</h3></div></div><div class="j-prompt-cont"><div calss="j-w"><div class="j-tidings"><button id="j_add_lastname" class="j-bg-btn j-layout-btn" style="margin-right:12px;">添加姓氏</button><button id="j_add_firstname" class="j-bg-btn j-layout-btn">添加名字</button></div><textarea id="j_content" class="j-bg-main j-msg-cont" placeholder="请输入要群发的消息内容(请不要违返Linkedin规则，发送黄赌毒等骚扰对方的广告消息，不要滥用群发功能。)"></textarea></div></div><div class="j-prompt-ctrl"><button id="j_cancel" class="j-bg-btn j-layout-btn">取消</button><button id="j_ok" class="j-bg-btn j-layout-btn">确定新增</button></div></div></div>'),$(".j-dialog").fadeIn(0),$("#j_cancel").on("click",function(){chrome.runtime.sendMessage({action:"getAllTidings",tag:e},function(e){})}),$("#j_ok").on("click",function(){SaveTidings(e)})}function AddFirstName(){InsertAfterText(document.getElementById("j_content"),"[FirstName]")}function AddLastName(){InsertAfterText(document.getElementById("j_content"),"[LastName]")}function InsertAfterText(e,t){var i;if(document.selection)e.focus(),i=document.selection.createRange(),i.text=t,e.focus();else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,o=e.selectionEnd,a=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,
e.selectionEnd=n+t.length,e.scrollTop=a}else e.value+=t}function SaveTidings(e){var t=$.trim($("#j_content").val());if(!t)return PointOut("发送内容不能为空",2),!1;chrome.storage.sync.get({account:""},function(i){if(!String(i.account))return PointOut("请先登录领英精灵账号",3),!1;var n=String((new Date).getTime()),o={tidings:t,tidings_id:n};o=JSON.stringify(o),chrome.runtime.sendMessage({action:"upload",type:"saveTidings",data:o,other:e},function(e){})})}function SaveTidingsResult(e){switch(e){case 0:PointOut("消息保存失败，请尝试刷新页面或重启浏览器");break;case 1:PointOut("消息保存成功",1);break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("消息保存失败，请尝试刷新页面或重启浏览器")}}function DeleteTidings(){var e=$(this).parents("tr").attr("tidings_id"),t=$.trim($("#j_newtidings").attr("tag")),i=$.trim($("#j_newtidings").attr("groupid")),n={tag:t,groupId:i};chrome.runtime.sendMessage({action:"upload",type:"deleteTidings",data:e,other:n},function(e){})}function DeleteTidingsResult(e){switch(e){case 0:PointOut("删除失败，请尝试刷新页面或重启浏览器");break;case 1:PointOut("删除成功",3);break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("删除失败，请尝试刷新页面或重启浏览器")}}function SelectTidings(){var e=$.trim($(this).parents("tr").attr("tidings_id"));$(this).prop("checked")?chrome.runtime.sendMessage({action:"selectTidings",tidingsId:e,isSelect:1},function(e){}):chrome.runtime.sendMessage({action:"selectTidings",tidingsId:e,isSelect:0},function(e){})}function ReviseTidings(){var e=$(this).text();$(this).html('<textarea class="j-revise">'+e+"</textarea>"),$(".j-revise").focus()}function UpdateTidings(){var e=$.trim($(this).val());if(!e){PointOut("群发的内容不能为空");var t=$.trim($("#j_newtidings").attr("tag"));return chrome.runtime.sendMessage({action:"getAllTidings",tag:t},function(e){}),!1}var i=$.trim($(this).parents("tr").attr("tidings_id")),n={tidings_id:i,tidings:e};n=JSON.stringify(n);var o=$.trim($("#j_newtidings").attr("tag")),a=$.trim($("#j_newtidings").attr("groupid")),t={tag:o,groupId:a};chrome.runtime.sendMessage({action:"upload",type:"updateTidings",data:n,other:t},function(e){})}function UpdateTidingsResult(e){switch(e){case 0:PointOut("修改失败，请尝试刷新页面或重启浏览器");break;case 1:PointOut("修改成功");break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("修改失败，请尝试刷新页面或重启浏览器")}}function StartSendMsg(){var e=$.trim($("#j_newtidings").attr("tag")),t=$.trim($("#j_newtidings").attr("groupid")),i={tag:e,groupId:t};chrome.runtime.sendMessage({action:"startSendMsg",tag:i},function(e){})}function StartSendMsgResult(e,t,i,n){switch(e){case 0:PointOut("群发失败，请尝试刷新页面或重启浏览器");break;case 1:switch($(".j-dialog").remove(),Tidings=t,i.tag){case"groupAll":Friend=n,CurPos=Friend.length,ActionCount=0,ShowStatu("组内群发..."),SendMsgForNoLoop();break;case"groupSelect":CurPos=Friend.length,ActionCount=0,ShowStatu("组内群发..."),SendMsgForNoLoop();break;case"friendAll":CurPos=Friend.length,ActionCount=0,ShowStatu("群发消息..."),SendMsgForLoop();break;case"friendSelect":CurPos=Friend.length,ActionCount=0,ShowStatu("群发消息..."),SendMsgForNoLoop();break;default:PointOut("群发消息失败，请尝试刷新页面或重启浏览器")}break;case 2:CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1);break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;case 4:PointOut("没有设置或选择要发送的消息内容");break;case 5:PointOut("此分组中没有可发送的好友，请确定该分组中的好友是否在指定时间内都发送过或在禁发名单中");break;default:PointOut("群发失败，请尝试刷新页面或重启浏览器")}}function SendMsgForNoLoop(){chrome.storage.sync.get({s_today_num:0,s_limit:100,level:0},function(e){return parseInt(e.level)<1&&parseInt(e.s_today_num)>=10?(StopAction(),setTimeout(function(){confirm("今天群发名额已用完，普通会员每天可群发10条，若要发送更多，请升级VIP会员使用")&&UpVip()},50),!1):parseInt(e.s_today_num)>=parseInt(e.s_limit)?(StopAction(),setTimeout(function(){alert("今日累计发送 "+parseInt(e.s_today_num)+" 条消息，超过每日最多发送量，请明天再来发送或将每日最多发送量设置大些。")},50),!1):--CurPos<0?(StopAction(),void setTimeout(function(){if(0==ActionCount)return alert("群发完成，本次群发0条，要群发的好友可能在指定时间内有群发过或在禁发名单中"),!1;alert("群发完成，本次群发"+ActionCount+"条消息")},50)):void chrome.runtime.sendMessage({action:"checkSend",urn:Friend[CurPos].entityUrn,tag:"noLoop"},function(e){})})}function SendMsgForLoop(){chrome.storage.sync.get({s_today_num:0,s_limit:100,level:0},function(e){return parseInt(e.level)<1&&parseInt(e.s_today_num)>=10?(StopAction(),setTimeout(function(){confirm("今天群发名额已用完，普通会员每天可群发10条，若要发送更多，请升级VIP会员使用")&&UpVip()},50),!1):parseInt(e.s_today_num)>=parseInt(e.s_limit)?(StopAction(),setTimeout(function(){alert("今日累计发送 "+parseInt(e.s_today_num)+" 条消息，超过每日最多发送量，请明天再来发送或将每日最多发送量设置大些。")},50),!1):--CurPos<0?(StopAction(),setTimeout(function(){if(0==ActionCount)return alert("群发完成，本次群发0条，要群发的好友可能在指定时间内有群发过或在禁发名单中"),!1;alert("群发完成，本次群发"+ActionCount+"条消息")},50),!1):void chrome.runtime.sendMessage({action:"checkSend",urn:Friend[CurPos].entityUrn,tag:"loop"},function(e){})})}function CheckSendResult(e,t,i){switch(e){case 0:switch(t){case"noLoop":SendMsgForNoLoop();break;case"loop":if(0==CurPos)if($("#j_friend_paging .j-curpage").next().length>0){var n=parseInt($("#j_friend_paging .j-curpage").next().text());GetFriendData(n);var o=GetTime(1,30,60);Timeout=setTimeout(function(){SendMsgForLoop()},1e3*o)}else StopAction(),setTimeout(function(){alert("群发完成，本次群发"+ActionCount+"条消息")},50);else SendMsgForLoop();break;default:StopAction(),setTimeout(function(){alert("群发完成，本次群发"+ActionCount+"条消息")},50)}break;case 1:chrome.storage.sync.get({s_min_speed:30,s_max_speed:60,s_today_num:0,risk:!0},function(e){var n=GetTidings(i.firstName,i.lastName);if(n){var o=GetTime(parseInt(e.s_today_num),parseInt(e.s_min_speed),parseInt(e.s_max_speed),e.risk);switch(Delayed_time=o,DelayedTime(),SendMsg(i.entityUrn,n),t){case"noLoop":var a="sendMsgForNoLoop";break;case"loop":var a="sendMsgForLoop";if(0==CurPos)if($("#j_friend_paging .j-curpage").next().length>0){var r=parseInt($("#j_friend_paging .j-curpage").next().text());GetFriendData(r)}else StopAction(),setTimeout(function(){alert("群发完成，本次成功发送 "+ActionCount+" 条消息。")},50);break;default:StopAction(),setTimeout(function(){alert("群发完成，本次成功发送 "+ActionCount+" 条消息。")},50)}Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:a,other:""},function(e){})},1e3*o)}else StopAction(),setTimeout(function(){alert("消息内容为空，本次群发"+ActionCount+"条消息")},50)});break;case 2:StopAction(),setTimeout(function(){alert("没有登录领英精灵，请登录领英精灵账号")},50);break;case 3:StopAction(),setTimeout(function(){alert("没有绑定Linkedin账号，请先绑定Linkedin账号")},50)}}function SendMsg(e,t){var i={conversationCreate:{eventCreate:{value:{"com.linkedin.voyager.messaging.create.MessageCreate":{attachments:[],attributedBody:{attributes:[],text:t}}}},recipients:[e],subtype:"MEMBER_TO_MEMBER"},keyVersion:"LEGACY_INBOX"},n=getCookie("JSESSIONID").replace(/"/g,"");if(!n)return!1;$.ajax({url:"https://www.linkedin.com/voyager/api/messaging/conversations?action=create",type:"post",data:JSON.stringify(i),headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":n,"content-type":"application/json; charset=UTF-8","x-restli-protocol-version":"2.0.0"},success:function(t){ActionCount++,chrome.storage.sync.get({s_today_num:0},function(t){var i=parseInt(t.s_today_num)+1;$("#j_success_count").text("本次："+ActionCount),$("#j_today_count").text("今日："+i),chrome.storage.sync.set({s_today_num:[i]},function(){}),chrome.runtime.sendMessage({action:"upload",type:"saveSendRecord",data:e,other:""},function(e){})})}})}function UpdateWhitelist(){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41),t=$.trim($(this).parents(".j-friend").attr("id")).slice(0,1),i=[];if(i.push(e),$(this).hasClass("j-ico-whitelist-0"))var n=1;else var n=0;var i=JSON.stringify(i);chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:i,other:n,tag:t},function(e){})}function StartDigForA(){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41),t=$.trim($(this).parents(".j-friend").attr("id")).slice(0,1);$(this).hasClass("j-ico-dig-1")?chrome.runtime.sendMessage({action:"getProfile",urn:e,other:""},function(e){}):(PointOut("正在挖掘中...",5),chrome.runtime.sendMessage({action:"checkDig",urn:e,tag:t},function(e){}))}function StartGroupDigForBatch(){var e=$.trim($(this).parents(".j-group-box").attr("groupid")),t=$(this).parents(".j-group-tool").prev().find("span:first").text();chrome.storage.sync.get({run:!1,d_today_num:0,d_limit:100},function(i){if(i.run)return PointOut("正在批量操作中，请先停止操作，再进行组内挖掘"),!1;if(parseInt(i.d_today_num)>=parseInt(i.d_limit))return PointOut("今日累计挖掘 "+parseInt(i.d_today_num)+" 条，超过每日最多挖掘量，请明天再来挖掘或将每日最多挖掘量设置大些。"),!1;var n=$("input[name='g_"+e+"']").length;if(0==n)return PointOut("该分组中没有好友"),!1;n=$("input[name='g_"+e+"']:checkbox:checked").length,0==n?(JlConfirm('确定要挖掘 "'+t+'" 分组中的好友资料吗？'),$("#j_ok").on("click",function(){chrome.runtime.sendMessage({action:"getGroupDigFriend",groupId:e},function(e){})})):(Friend=[],$("input[name='g_"+e+"']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),JlConfirm("确定要挖掘选择的 "+n+" 位好友资料吗？"),$("#j_ok").on("click",function(){CurPos=Friend.length,ActionCount=0,ShowStatu("组内挖掘..."),DigFriendForBatch("noLoop")}))})}function DigFriendForBatch(e){if(--CurPos<0)return StopAction(),setTimeout(function(){0==ActionCount?alert("选择的好友都挖掘过"):alert("挖掘完成，本次成功挖掘 "+ActionCount+" 条")},50),!1;chrome.storage.sync.get({d_today_num:0,d_limit:100},function(t){if(parseInt(t.d_today_num)>=parseInt(t.d_limit))return StopAction(),setTimeout(function(){alert("今日累计挖掘 "+parseInt(t.d_today_num)+" 条，超过每日最多挖掘量，请明天再来挖掘或将每日最多挖掘量设置大些。")},50),!1;if(chrome.runtime.sendMessage({action:"checkDig",urn:Friend[CurPos].entityUrn,tag:e},function(e){}),"loop"==e&&0==CurPos)if($("#j_friend_paging .j-curpage").next().length>0){var i=parseInt($("#j_friend_paging .j-curpage").next().text());GetFriendData(i)}else StopAction(),setTimeout(function(){alert("挖掘完成，本次成功挖掘 "+ActionCount+" 条。")},50)})}function GetGroupDigFriendResult(e,t){switch(e){case 0:PointOut("批量挖掘失败");break;case 1:Friend=t,CurPos=Friend.length,ShowStatu("组内群发..."),ActionCount=0,DigFriendForBatch("noLoop");break;case 2:StopAction(),setTimeout(function(){alert("没有登录领英精灵，请登录领英精灵账号")},50);break;case 3:StopAction(),setTimeout(function(){alert("没有绑定Linkedin账号，请先绑定Linkedin账号")},50);break;case 4:PointOut("已超今日最大挖掘量，请明天再来挖掘或将每日最多挖掘量设置大些");break;case 5:PointOut("该分组中的好友已全部挖掘")}}function StartMoveGroupForBatch(){var e=$.trim($(this).parents(".j-group-box").attr("groupid"));Friend=[],$("input[name='g_"+e+"']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),Friend.length<=0?PointOut("请选择要移动的好友"):chrome.runtime.sendMessage({action:"getGroup",tag:"moveGroupForBatch",groupId:e},function(e){})}function AddWhitelistForGroup(){var e=$.trim($(this).parents(".j-group-box").attr("groupid")),t=[];$("input[name='g_"+e+"']:checkbox:checked").each(function(){t.push($.trim($(this).parents("div.j-friend").attr("id")).slice(2,41))}),t.length<=0?PointOut("请选择要添加到禁发名单的好友"):(JlConfirm("确定要将选择的 "+t.length+" 位好友添加到禁发名单吗？","确定"),$("#j_ok").on("click",function(){t=JSON.stringify(t),chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:t,other:1,tag:"g"},function(e){})}))}function ShowMoveGroupForBatch(e,t){for(var i='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>移动到</h3></div></div><div class="j-prompt-cont"><div class="j-new-group-box"><div><span>组名：</span></div><div><select id="j_select_group" style="padding:6px">',n=0;n<e.length;n++)e[n].groupId==t?i+='<option selected="selected" value='+e[n].groupId+">"+e[n].groupName+"</option>":i+="<option value="+e[n].groupId+">"+e[n].groupName+"</option>";i+='</select></div></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_move_group" class="j-bg-btn j-layout-btn">确定移动</button></div></div></div>',$("#lyjl").append(i),$(".j-dialog").fadeIn(200),$("#j_move_group").on("click",function(){var e=$.trim($("#j_select_group").val());if(e==t)return PointOut("选择的分组与原分组相同"),!1;var i=JSON.stringify(Friend),n={groupId:e,tag:"batch"};n=JSON.stringify(n),chrome.runtime.sendMessage({action:"upload",type:"moveGroup",data:i,other:n},function(e){})})}function MoveGroupResult(e,t,i){switch(e){case 0:PointOut("移动失败，请尝试刷新页面或重启浏览器");break;case 1:PointOut("移动成功"),$(".j-dialog").remove();for(var n=0;n<t.length;n++)$("#g_"+t[n].entityUrn).remove();break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("移动失败，请尝试刷新页面或重启浏览器")}}function EditFriendRemark(){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41);chrome.runtime.sendMessage({action:"getFriendRemark",urn:e},function(e){})}function GetFriendRemarkResult(e,t){switch(e){case 0:PointOut("备注修改失败");break;case 1:ShowEditFriendDialog(t);break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("备注修改失败")}}function ShowEditFriendDialog(e){var t='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>修改好友备注</h3></div></div><div class="j-prompt-cont"><div class="j-new-group-box" style="margin-top:12px;"><textarea id="j_friend_remarks" class="j-group-desc" placeholder="请输入好友备注(选填，最多100个字符)" maxlength=100>'+e.remarks+'</textarea></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_edit_friend" class="j-bg-btn j-layout-btn">确定</button></div></div></div>';$("#lyjl").append(t),$(".j-dialog").fadeIn(200),$("#j_edit_friend").on("click",function(){var t=$.trim($("#j_friend_remarks").val());chrome.runtime.sendMessage({action:"upload",type:"editFriendRemark",data:e.entityUrn,other:t},function(e){})})}function EditFriendRemarkResult(e){switch(e){case 0:PointOut("编辑失败");break;case 1:PointOut("备注修改成功"),$(".j-dialog").remove();break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("备注修改失败")}}function DeleteFriendOnGroup(){var e=$.trim($(this).parents(".j-group-box").attr("groupid"));Friend=[],$("input[name='g_"+e+"']:checkbox:checked").each(function(){var e={};e.entityUrn=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41),Friend.push(e)}),Friend.length<=0?PointOut("请选择要移出的好友"):(JlConfirm("确定要将选择的 "+Friend.length+" 位好友移出分组吗？","确定"),$("#j_ok").on("click",function(){var e=JSON.stringify(Friend),t={groupId:"1",tag:"batch"};t=JSON.stringify(t),chrome.runtime.sendMessage({action:"upload",type:"moveGroup",data:e,other:t},function(e){})}))}function ShowRemarkResult(e,t,i){if(1==e&&t.remarks){var n=$("#"+i+"_"+t.entityUrn).find(".j-position");n.removeClass("j-show"),n.addClass("j-hide"),$("#"+i+"_"+t.entityUrn).find(".j-profile").append('<p class="j-remarks j-show">'+t.remarks+"</p>")}}function ShowDigPage(){$("#j_dig_box").empty(),$("#j_dig_paging").empty();$("#j_dig_box").append('<div class="j-explain-box j-w"><p>导出功能可导出已挖掘的好友资料，导出前请先挖掘。</p><p style="color:#999;">若搜索框中没有关键词会显示全部已挖掘的好友；若有关键词只会显示与此关键词匹配的已挖掘的好友。关键词只匹配姓、名、职位、备注</p><a href="http:linkedinjl.com/h?o=dig" target="_black">查看详细使用说明</a></div>'),$("#j_dig_tool").css("visibility","hidden"),SearchDig()}function SearchDigEnter(e){13==e.keyCode&&SearchDig()}function SearchDig(){GetDig(1,20,$.trim($("#j_dig_keyword").val()))}function GetDig(e,t,i){chrome.storage.sync.get({account:"",my_urn:""},function(n){var o=String(n.account),a=String(n.my_urn);return o?a?void chrome.runtime.sendMessage({action:"getDig",page:e,count:t,keyword:i},function(e){}):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1):(CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1),!1)})}function GetDigResult(e,t,i,n,o){switch(e){case 0:PointOut("获取失败");break;case 1:var a=t;if($("#j_dig_box").empty(),a){$("#j_dig_tool").css("visibility","visible");for(var r=0;r<a.length;r++)AppendDigToTable(a[r]);PointOut("获取成功",1)}else{$("#j_dig_tool").css("visibility","hidden");$("#j_dig_box").append('<div class="j-explain-box j-w"><p>导出功能可导出已挖掘的好友资料，导出前请先挖掘。</p><p style="color:#999;">若搜索框中没有关键词会显示全部已挖掘的好友；若有关键词只会显示与此关键词匹配的已挖掘的好友。关键词只匹配姓、名、职位、备注</p><a href="http:linkedinjl.com/h?o=dig" target="_black">查看详细使用说明</a></div>'),PointOut("没有匹配的已挖掘好友",3)}$("input[name='selectalldig']").prop("checked",!1),ShowPaging("j_dig_paging",n,i,o);break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}}function AppendDigToTable(e){e.img||(e.img="http://linkedinjl.com/expand/version8/img/me.png");var t=GetName(e.firstName,e.lastName),i='<div class="j-friend" id=d_'+e.entityUrn+'><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+e.publicId+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+e.img+'"></div></a><div class="j-profile" title="双击显示详细联系方式"><h3>'+t+'</h3><p class="j-show">'+e.position+'</p></div></div><div><input type="checkbox" name="dig"></div></div></div>';$("#j_dig_box").append(i)}function SelectAllDig(){if($(this).prop("checked")){$("input[name='dig']").prop("checked",!0);var e=$("input[name='dig']:checkbox:checked").length;0==e?PointOut("没有可选",3):PointOut("选择了 "+e+" 位",1)}else $("input[name='dig']").prop("checked",!1)}function JumpDig(e){if(13==e.keyCode){var t=parseInt($(this).val());if(!/^[1-9][0-9]*$/.test(t))return PointOut("请输入正确的页数",3),!1;var i=parseInt($("#j_dig_paging .j-paging:last").text());if(t>i)return PointOut("请输入有效页数: 1 - "+i+" 范围内",3),!1;return GetDig(t,20,$.trim($("#j_dig_keyword").val())),!0}}function GetDigSomePage(){GetDig(parseInt($(this).text()),20,$.trim($("#j_dig_keyword").val()))}function ExportDig(){chrome.storage.sync.get({account:"",my_urn:"",level:0},function(e){var t=String(e.account),i=String(e.my_urn);if(!t)return PointOut("请先登录领英精灵账号",3),CreatLoginDialog(),!1;if(!i)return JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1;if(e.level<2)return ShowDiff("非钻石会员不支持导出","非钻石会员不支持导出功能，请升级钻石会员导出，感谢支持："),!1;var n=$("input[name='dig']:checkbox:checked").length;if(n>0)return JlConfirm("确定要导出选择的 "+n+" 位好友资料吗？","确定"),$("#j_ok").on("click",function(){var e=[];$("input[name='dig']:checkbox:checked").each(function(){e.push($.trim($(this).parents(".j-friend").attr("id")).slice(2,41))}),e=JSON.stringify(e),window.open("http://linkedinjl.com/expdig/account/"+t+"/f/"+e),PointOut("导出成功"),$("input[name='dig']").prop("checked",!1)}),!1;$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-confirm-box j-digdate j-div-center j-box-sha"><div><p>选择挖掘日期</p></div><div class="j-nowrap"><div title="导出今日挖掘的"><input type="radio" name="digdate" value="today" checked="checked">今日</div><div title="导出近一周挖掘的"><input type="radio" name="digdate" value="week">一周</div><div title="导出近一月挖掘的"><input type="radio" name="digdate" value="month">一月</div><div title="导出全部挖掘的"><input type="radio" name="digdate" value="all">全部</div></div><div style="text-align:right;"><button id="j_cancel" class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_ok" class="j-bg-btn j-layout-btn j-close-dialog">确定</button></div></div></div>'),$(".j-dialog").fadeIn(200),$("#j_ok").on("click",function(){var e=$.trim($("input[name='digdate']:checked").val());window.open("http://linkedinjl.com/expdig/account/"+t+"/my_urn/"+i+"/digdate/"+e)})})}function CheckDigResult(e,t,i,n){switch(e){case 0:switch(n){case"g":case"f":PointOut("挖掘失败");break;case"noLoop":case"loop":CurPos<=0?chrome.storage.sync.get({d_min_speed:60,d_max_speed:120,d_today_num:0,risk:!0},function(e){var t=GetTime(parseInt(e.d_today_num),parseInt(e.d_min_speed),parseInt(e.d_max_speed),e.risk);Timeout=setTimeout(function(){DigFriendForBatch(n)},1e3*t)}):DigFriendForBatch(n);break;case"autoDig":break;default:PointOut("挖掘失败")}break;case 1:switch(n){case"g":case"f":DigData(t,i,n);break;case"noLoop":case"loop":DigData(t,i,n),chrome.storage.sync.get({d_min_speed:60,d_max_speed:120,d_today_num:0,risk:!0},function(e){var t=GetTime(parseInt(e.d_today_num),parseInt(e.d_min_speed),parseInt(e.d_max_speed),e.risk);Delayed_time=t,DelayedTime(),ActionCount++;var i=parseInt(e.d_today_num)+1;$("#j_success_count").text("本次："+ActionCount),$("#j_today_count").text("今日："+i),Timeout=setTimeout(function(){DigFriendForBatch(n)},1e3*t)});break;case"autoDig":chrome.storage.sync.get({d_min_speed:220,d_max_speed:440,d_today_num:0,risk:!0,d_last_time:100},function(e){if(parseInt(e.d_today_num)>=88)return!1;var o=parseInt(e.d_last_time)+12e4,a=(new Date).getTime();if(a>o){chrome.storage.sync.get({d_last_time:[a]},function(){DigData(t,i,n)});var r=GetTime(parseInt(e.d_today_num),parseInt(e.d_min_speed),parseInt(e.d_max_speed),e.risk);setTimeout(function(){AutoDig()},1e3*r)}else AutoDigPos++,setTimeout(function(){AutoDig()},16e4)});break;default:StopAction(),setTimeout(function(){alert("挖掘完成，本次成功挖掘"+ActionCount+"条")},50)}break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;case 4:switch(n){case"g":case"f":PointOut("已挖掘过");break;case"noLoop":case"loop":0==CurPos?Timeout=setTimeout(function(){DigFriendForBatch(n)},1e4):DigFriendForBatch(n);break;case"autoDig":AutoDig();break;default:PointOut("挖掘失败")}break;default:switch(n){case"g":case"f":PointOut("挖掘失败");break;case"noLoop":case"loop":DigFriendForBatch(n);break;case"autoDig":AutoDig();break;default:PointOut("挖掘失败")}}}function DigData(e,t,i){var n={},o=[],a=[],r=[],s=getCookie("JSESSIONID").replace(/"/g,"");if(!s)return!1;var c="https://www.linkedin.com/voyager/api/identity/profiles/"+t+"/profileContactInfo";$.ajax({url:c,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":s,"x-restli-protocol-version":"2.0.0"},success:function(c){var d=c.data;if(d&&d.emailAddress?n.email=d.emailAddress:n.email="",d&&d.address?n.address=d.address.substr(0,140):n.address="",d&&d.connectedAt?n.connected=d.connectedAt:n.connected=1e7,d&&d.entityUrn?n.urn=d.entityUrn.split(":")[3]:n.urn=null,d&&d.ims){for(var l="",u=0;u<d.ims.length;u++)l=l+d.ims[u].provider+":"+d.ims[u].id+" ";n.ims=l}else n.ims="";if(d&&d.phoneNumbers){for(var p="",u=0;u<d.phoneNumbers.length;u++)p=p+d.phoneNumbers[u].type+":"+d.phoneNumbers[u].number+" ";n.phone=p}else n.phone="";if(d&&d.twitterHandles){for(var g="",u=0;u<d.twitterHandles.length;u++)g=g+d.twitterHandles[u].name+" ";n.twitter=g}else n.twitter="";if(d&&d.websites){for(var m="",u=0;u<d.websites.length;u++)m=m+d.websites[u].type.category+":"+d.websites[u].url+" ";n.websites=m.substr(0,200)}else n.websites="";var v="https://www.linkedin.com/voyager/api/identity/profiles/"+t+"/profileView";$.ajax({url:v,type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":s,"x-restli-protocol-version":"2.0.0"},success:function(e){var s=e.included;if(s){for(var c=0;c<s.length;c++){if("com.linkedin.voyager.identity.profile.Profile"==s[c].$type){var d=s[c];d&&d.locationName?n.city=d.locationName:n.city="",d&&d.industryName?n.industry=d.industryName:n.industry="",d&&d.summary?n.about=d.summary.substr(0,2e3):n.about="",d&&d.geoCountryName?n.country=d.geoCountryName:n.country=""}if("com.linkedin.voyager.identity.shared.MiniProfile"==s[c].$type){var l=s[c];l&&l.firstName?n.firstname=l.firstName:n.firstname="",l&&l.lastName?n.lastname=l.lastName:n.lastname="",l&&l.occupation?n.position=l.occupation.substr(0,120):n.position="",l&&l.picture&&l.picture.rootUrl&&l.picture.artifacts&&l.picture.artifacts[0].fileIdentifyingUrlPathSegment?n.img=l.picture.rootUrl+l.picture.artifacts[0].fileIdentifyingUrlPathSegment:n.img=""}if("com.linkedin.voyager.identity.profile.Position"==s[c].$type){var u={};if(s[c].entityUrn){var p=s[c].entityUrn.split(",")[1];u.workId=p.substring(0,p.length-1)}else u.workId=null;s[c].companyName?(n.company=s[c].companyName.substr(0,120),u.companyName=s[c].companyName.substr(0,120)):(u.companyName="",n.company=""),s[c].locationName?u.locationName=s[c].locationName.substr(0,120):u.locationName="",s[c].title?u.position=s[c].title.substr(0,140):u.position="",s[c].description?u.description=s[c].description.substr(0,2e3):u.description="",s[c].timePeriod&&s[c].timePeriod.startDate&&s[c].timePeriod.startDate.year?u.startYear=s[c].timePeriod.startDate.year:u.startYear=0,s[c].timePeriod&&s[c].timePeriod.startDate&&s[c].timePeriod.startDate.month?u.startMonth=s[c].timePeriod.startDate.month:u.startMonth=0,s[c].timePeriod&&s[c].timePeriod.endDate&&s[c].timePeriod.endDate.year?u.endYear=s[c].timePeriod.endDate.year:u.endYear=0,s[c].timePeriod&&s[c].timePeriod.endDate&&s[c].timePeriod.endDate.month?u.endMonth=s[c].timePeriod.endDate.month:u.endMonth=0,o.push(u)}if("com.linkedin.voyager.identity.profile.Education"==s[c].$type){var g={};if(s[c].entityUrn){var m=s[c].entityUrn.split(",")[1];g.eduId=m.substring(0,m.length-1)}else g.eduId=null;s[c].schoolName?(n.school=s[c].schoolName,g.schoolName=s[c].schoolName.substr(0,120)):(n.school="",g.schoolName=""),s[c].fieldOfStudy?g.major=s[c].fieldOfStudy.substr(0,120):g.major="",s[c].degreeName?g.degreeName=s[c].degreeName.substr(0,120):g.degreeName="",s[c].description?g.description=s[c].description.substr(0,2e3):g.description="",s[c].timePeriod&&s[c].timePeriod.startDate&&s[c].timePeriod.startDate.year?g.startYear=s[c].timePeriod.startDate.year:g.startYear=0,s[c].timePeriod&&s[c].timePeriod.startDate&&s[c].timePeriod.startDate.month?g.startMonth=s[c].timePeriod.startDate.month:g.startMonth=0,s[c].timePeriod&&s[c].timePeriod.endDate&&s[c].timePeriod.endDate.year?g.endYear=s[c].timePeriod.endDate.year:g.endYear=0,s[c].timePeriod&&s[c].timePeriod.endDate&&s[c].timePeriod.endDate.month?g.endMonth=s[c].timePeriod.endDate.month:g.endMonth=0,a.push(g)}if("com.linkedin.voyager.identity.profile.Skill"==s[c].$type){var v={};if(s[c].entityUrn){var h=s[c].entityUrn.split(",")[1];v.skillId=h.substring(0,h.length-1)}else v.skillId=null;s[c].name?v.skillName=s[c].name:v.skillName="",r.push(v)}}n.publicId=t,n.score=GaveAMark(n),o=JSON.stringify(o),a=JSON.stringify(a),n=JSON.stringify(n),r=JSON.stringify(r),chrome.runtime.sendMessage({action:"saveDigData",profile:n,work:o,education:a,skill:r,other:"",tag:i},function(e){})}},error:function(t,n,o){403==t.status&&chrome.runtime.sendMessage({action:"upload",type:"deleteInvalidFriend",data:e,other:i},function(e){})}})},error:function(t,n,o){403==t.status&&chrome.runtime.sendMessage({action:"upload",type:"deleteInvalidFriend",data:e,other:i},function(e){})}})}function GaveAMark(e){var t=0;return t=e.email?t:t+10,t=e.phone?t:t+10,t=e.ims?t:t+4,t=e.twitter?t:t+2,t=e.position?t:t+2,t=e.address?t:t+2,t=e.city?t:t+1,t=e.school?t:t+2,t=e.img?t:t+2,t=e.about?t:t+2,t=e.company?t:t+2,t=e.country?t:t+1}function SaveDigDataResult(e,t,i,n){switch(e){case 0:PointOut("挖掘失败");break;case 1:switch(i){case"g":$("#g_"+t).find(".j-dig").removeClass("j-ico-dig-0"),$("#g_"+t).find(".j-dig").addClass("j-ico-dig-1"),$("#g_"+t).find(".j-dig").attr("title","已挖掘，点击查看详情"),PointOut("挖掘成功"),ShowProfile(n);break;case"f":$("#f_"+t).find(".j-dig").removeClass("j-ico-dig-0"),$("#f_"+t).find(".j-dig").addClass("j-ico-dig-1"),$("#f_"+t).find(".j-dig").attr("title","已挖掘，点击查看详情"),PointOut("挖掘成功"),ShowProfile(n)}break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}}function DeleteInvalidFriendResult(e,t,i){"g"&&(PointOut("该人脉无效"),$("#g_"+t).remove())}function StartAutoDig(){var e=window.location.href;new RegExp("/feed","i").test(e)&&chrome.storage.sync.get({account:"",my_urn:""},function(e){var t=String(e.account),i=String(e.my_urn);if(!t||!i)return!1;chrome.runtime.sendMessage({action:"getAutoDigFriend",total:100},function(e){})})}function GetAutoDigFriendResult(e,t){1==e&&(AutoFriend=t,AutoDigPos=AutoFriend.length,AutoDig())}function AutoDig(){if(--AutoDigPos<0)return!1;chrome.runtime.sendMessage({action:"checkDig",urn:AutoFriend[AutoDigPos],tag:"autoDig"},function(e){})}function ShowProbePage(){if(ProbePage){$("#j_probe_box").empty(),$("#j_probe_paging").empty();$("#j_probe_box").append('<div class="j-explain-box j-w"><p>窥探功能可突破Linkedin限制，无需加好友，直接导出部分非好友资料(邮箱、电话、社交账号等)，并可导出到Excel表格。</p><a href="http:linkedinjl.com/h?o=probe" target="_black">查看详细使用说明</a></div>'),$("#j_probe_tool").css("visibility","hidden"),ProbePage=!1}}function StartProbeEnter(e){13==e.keyCode&&StartProbe()}function StartProbe(){var e=$("#j_probe_keyword").val();return e?e.length<2?(PointOut("关键词设置太泛，请设置至少2个字符的关键词",2),$("#j_probe_keyword").focus(),!1):void Probe(e,1):(PointOut("请输入窥探关键词",2),$("#j_probe_keyword").focus(),!1)}function Probe(e,t){chrome.runtime.sendMessage({action:"probe",keyword:e,page:t,other:""},function(e){PointOut("正在窥探中...",30)})}function ProbeResult(e,t){switch(e){case 0:PointOut("窥探失败"),$("#j_probe_box").empty(),$("#j_probe_paging").empty(),$("#j_probe_box").append('<div class="j-tips-box"><h2窥探失败！</h2><p>请确保网络可使用，不要使用任何翻墙工具！</p></div>');break;case 1:if(t){var i=JSON.parse(t);switch(i.statu){case 0:PointOut("非至尊会员"),ShowDiff("非至尊会员不支持窥探功能","若要窥探非好友资料，请使用至尊会员，感谢您的支持，具体区别如下：");break;case 1:PointOut("窥探成功",2),ShowProbeResult(i);break;case 2:PointOut("没有窥探到"),$("#j_probe_box").empty(),$("#j_probe_paging").empty(),$("#j_probe_box").append('<div class="j-tips-box"><h2>没有窥探到，请切换关键词窥探！</h2><p>建议使用行业、公司名或职业关键词，如：led、manage、apple</p></div>');break;case 3:PointOut("关键词设置不规范"),$("#j_probe_box").empty(),$("#j_probe_paging").empty(),$("#j_probe_box").append('<div class="j-tips-box"><h2关键词错误！</h2><p>关键词设置不规范，关键词长度需在2-32范围内</p></div>');break;default:PointOut("窥探失败"),$("#j_probe_box").empty(),$("#j_probe_paging").empty(),$("#j_probe_box").append('<div class="j-tips-box"><h2窥探失败！</h2><p>请确定已登录领英精灵账号和Linkedin账号，或尝试重启浏览器！</p></div>')}}break;case 2:PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog();break;case 3:JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)});break;default:PointOut("窥探失败"),$("#j_probe_box").empty(),$("#j_probe_paging").empty(),$("#j_probe_box").append('<div class="j-tips-box"><h2窥探失败！</h2><p>请确保网络可使用，不要使用任何翻墙工具！</p></div>')}}function ShowProbeResult(e){var t=e.data;ShowPaging("j_probe_paging",parseInt(e.page),parseInt(e.total),100),$("#j_probe_tool").css("visibility","visible"),$("#j_probe_box").empty();for(var i=0;i<t.length;i++)AppendProbeToTable(t[i])}function AppendProbeToTable(e){e.img||(e.img="http://linkedinjl.com/expand/version8/img/me.png")
;var t=GetName(e.firstname,e.lastname),i='<div class="j-friend" pid='+e.id+" id=p_"+e.entityurn+'><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+e.publicid+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+e.img+'"></div></a><div class="j-profile" title="双击显示详细联系方式"><h3>'+t+'</h3><p class="j-show">'+e.position+'</p></div></div><div><input type="checkbox" name="probe"></div></div></div>';$("#j_probe_box").append(i)}function JumpProbe(e){if(13==e.keyCode){var t=$("#j_probe_keyword").val();if(!t)return PointOut("请输入窥探关键词",2),$("#j_probe_keyword").focus(),!1;if(t.length<2)return PointOut("关键词设置太泛，请设置至少2个字符的关键词",2),$("#j_probe_keyword").focus(),!1;var i=parseInt($("#j_probe_paging .j-paging:last").text()),n=parseInt($(this).val());if(n>i)return PointOut("请输入正确页数，1 - "+i+" 范围内",3),!1;chrome.storage.sync.get({level:0},function(e){parseInt(e.level)>2&&Probe(t,n)})}}function SelectAllProbe(){if($(this).prop("checked")){$("input[name='probe']").prop("checked",!0);var e=$("input[name='probe']:checkbox:checked").length;0==e?PointOut("没有可选",1):PointOut("选择了 "+e+" 位",1)}else $("input[name='probe']").prop("checked",!1)}function ProbeSomePage(){var e=$("#j_probe_keyword").val();if(!e)return PointOut("请输入窥探关键词",2),$("#j_probe_keyword").focus(),!1;if(e.length<2)return PointOut("关键词设置太泛，请设置至少2个字符的关键词",2),$("#j_probe_keyword").focus(),!1;var t=parseInt($(this).text());chrome.storage.sync.get({level:0},function(i){parseInt(i.level)>2&&Probe(e,t)})}function ExportProbe(){var e=$("input[name='probe']:checkbox:checked").length;if(e<=0)return PointOut("请选择要导出的人",3),!1;var t=[];$("input[name='probe']:checkbox:checked").each(function(){t.push($.trim($(this).parents(".j-friend").attr("pid")))}),t=JSON.stringify(t),chrome.storage.sync.get({account:"",my_urn:""},function(i){var n=String(i.account);String(i.my_urn);if(!n)return PointOut("请先登录领英精灵账号",3),CreatLoginDialog(),!1;window.open("http://linkedinjl.com/exportprobe/account/"+n+"/f/"+t),JlAlert("成功导出 "+e+"条人脉资料")})}function GetProfile(){var e=$.trim($(this).parents(".j-friend").attr("id")).slice(2,41);chrome.runtime.sendMessage({action:"getProfile",urn:e,other:""},function(e){})}function GetProfileResult(e,t){if(e&&t){ShowProfile(JSON.parse(t))}else PointOut("获取好友详细资料失败")}function ShowProfile(e){var t=GetName(e.firstname,e.lastname),i='<div class="j-dialog j-div-center j-detail-bg"><div class="j-detail-box j-div-center"><div><h2>'+t+"</h2></div><hr>";e.email&&(i+='<div class="j-nowrap-left j-contact"><font>邮箱：</font><span>'+e.email+"</span></div>"),e.phone&&(i+='<div class="j-nowrap-left j-contact"><font>电话：</font><span>'+e.phone+"</span></div>"),e.ims&&(i+='<div class="j-nowrap-left j-contact"><font>社交账号：</font><span>'+e.ims+"</span></div>"),e.twitter&&(i+='<div class="j-nowrap-left j-contact"><font>推特：</font><span>'+e.twitter+"</span></div>"),e.school&&(i+='<div class="j-nowrap-left"><font>学校：</font><span>'+e.school+"</span></div>"),e.country&&(i+='<div class="j-nowrap-left"><font>国家：</font><span>'+e.country+"</span></div>"),e.city&&(i+='<div class="j-nowrap-left"><font>城市：</font><span>'+e.city+"</span></div>"),e.address&&(i+='<div class="j-nowrap-left"><font>详细地址：</font><span>'+e.address+"</span></div>"),e.company&&(i+='<div class="j-nowrap-left"><font>公司：</font><span>'+e.company+"</span></div>"),e.position&&(i+='<div class="j-nowrap-left"><font>职位：</font><span>'+e.position+"</span></div>"),e.websites&&(i+='<div class="j-nowrap-left"><font>网址：</font><span>'+e.websites+"</span></div>"),e.about&&(i+='<div class="j-nowrap-left"><font>个人简介：</font></div><div class="j-about"><p>'+e.about+"</p></div>"),i+="</div></div>",$("#lyjl").append(i),$(".j-dialog").fadeIn(200)}function ShowWhitelistPage(){$("#j_whitelist_box").empty();$("#j_whitelist_box").append('<div class="j-explain-box j-w"><p>禁发名单中的好友在群发消息时会直接跳过，不会群发消息。</p><p style="color:#999;">若搜索框中有关键词，则只显示与此关键词匹配的禁发名单；若搜索框中没有关键词，则显示全部的禁发名单。关键词仅匹配姓、名、职位。）</p><a href="http:linkedinjl.com/h?o=whitelist" target="_black">查看详细使用说明</a></div>'),GetWhitelist(1,20,$.trim($("#j_whitelist_keyword").val()))}function SearchWhitelistEnter(e){if(13==e.keyCode){GetWhitelist(1,20,$.trim($("#j_whitelist_keyword").val()))}}function SearchWhitelist(){GetWhitelist(1,20,$.trim($("#j_whitelist_keyword").val()))}function GetWhitelist(e,t,i){chrome.storage.sync.get({account:"",my_urn:""},function(n){var o=String(n.account),a=String(n.my_urn);return o?a?void chrome.runtime.sendMessage({action:"getWhitelist",page:e,count:t,keyword:i},function(e){}):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1):(CreatLoginDialog(),PointOut("没有登录领英精灵，请登录领英精灵账号",1),!1)})}function GetWhitelistResult(e,t,i,n){var o=e;if($("#j_whitelist_box").empty(),o){$("#j_whitelist_tool").css("visibility","visible");for(var a=0;a<o.length;a++)AppendWhitelistToTable(o[a]);PointOut("获取完成",1)}else{$("#j_whitelist_tool").css("visibility","hidden"),$("#j_whitelist_box").empty();$("#j_whitelist_box").append('<div class="j-explain-box j-w"><p>禁发名单中的好友在群发消息时会直接跳过，不会群发消息。</p><p style="color:#999;">若搜索框中有关键词，则只显示与此关键词匹配的禁发名单；若搜索框中没有关键词，则显示全部的禁发名单。关键词仅匹配姓、名、职位。）</p><a href="http:linkedinjl.com/h?o=whitelist" target="_black">查看详细使用说明</a></div>'),PointOut("没有匹配的禁发好友")}$("input[name='selectallwhitelist']").prop("checked",!1),ShowPaging("j_whitelist_paging",i,t,n)}function AppendWhitelistToTable(e){e.img||(e.img="http://linkedinjl.com/expand/version8/img/me.png");var t=GetName(e.firstName,e.lastName),i='<div class="j-friend" id=w_'+e.entityUrn+'><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+e.publicId+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+e.img+'"></div></a><div class="j-profile"><h3>'+t+'</h3><p class="j-show">'+e.position+'</p></div></div><div><input type="checkbox" name="whitelist"></div></div></div>';$("#j_whitelist_box").append(i)}function JumpWhitelist(e){if(13==e.keyCode){var t=parseInt($(this).val());if(!/^[1-9][0-9]*$/.test(t))return PointOut("请输入正确的页数",3),!1;var i=parseInt($("#j_whitelist_paging .j-paging:last").text());if(t>i)return PointOut("请输入有效页数: 1 - "+i+" 范围内",3),!1;return GetWhitelist(t,20,$.trim($("#j_whitelist_keyword").val())),!0}}function GetWhitelistSomePage(){GetWhitelist(parseInt($(this).text()),20,$.trim($("#j_whitelist_keyword").val()))}function SelectAllWhitelist(){if($(this).prop("checked")){$("input[name='whitelist']").prop("checked",!0);var e=$("input[name='whitelist']:checkbox:checked").length;0==e?PointOut("没有可选",3):PointOut("选择了 "+e+" 位",1)}else $("input[name='whitelist']").prop("checked",!1)}function DeleteWhitelist(){if($("input[name='whitelist']:checkbox:checked").length>0){JlConfirm("确定要将选择的 "+$("input[name='whitelist']:checkbox:checked").length+" 位好友移出禁发名单吗？","确定"),$("#j_ok").on("click",function(){var e=[];$("input[name='whitelist']:checkbox:checked").each(function(){var t=$.trim($(this).parents("div.j-friend").attr("id")).slice(2,41);e.push(t)});var e=JSON.stringify(e);chrome.runtime.sendMessage({action:"upload",type:"updateWhitelist",data:e,other:0,tag:"whitelist"},function(e){})})}else PointOut("请选择要移出禁发名单的好友")}function InitLogin(){chrome.storage.sync.get({account:"",regTime:1,logintime:1,vipTime:1,diamondTime:1,supremeTime:1},function(e){var t=(new Date).getTime();if(parseInt(e.logintime)>t){var i=t-2592e6;parseInt(e.regTime)<i&&parseInt(e.vipTime)<t&&parseInt(e.diamondTime)<t&&parseInt(e.supremeTime)<t?($("#j_account").text(String(e.account)),InitMember(parseInt(e.vipTime),parseInt(e.diamondTime),parseInt(e.supremeTime))):ShowUp()}else CreatLoginDialog(),$("#j_account").text("未登录")})}function CreatLoginDialog(){$(".j-dialog").remove();$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-login-box j-bg-w j-div-center j-box-sha"><div class="j-logo" style="margin:auto;"></div><p id="j_errmsg" class="j-errmsg">请登录领英精灵</p><div><input id="j_acc" type="text" placeholder="领英精灵账号（手机号）" autocomplete="off"></div><div><input id="j_pw" type="password" placeholder="登录密码" autocomplete="off"></div><div><button id="j_login" class="j-login-btn j-bg-btn">登录</button></div><div><a href="http://www.linkedinjl.com/r" target="_black" class="j-reg-btn" title="前往免费注册">免费注册</a><a href="http://www.linkedinjl.com/resetpw" target="_black" class="j-reg-btn" title="找回密码">忘记密码</a></div></div></div>'),$(".j-dialog").fadeIn(200)}function Login(){var e=$.trim($("#j_acc").val()),t=/^1[3-9][0-9]{9}$/;if(!t.test(e))return $("#j_errmsg").text("*账号错误"),$("#j_errmsg").css("color","#f00"),$("#j_acc").focus(),!1;$("#j_errmsg").text("");var i=$.trim($("#j_pw").val());if(t=/^[0-9a-zA-Z]{6,16}$/,!t.test(i))return $("#j_errmsg").text("*密码错误"),$("#j_errmsg").css("color","#f00"),$("#j_pw").focus(),!1;$("#j_errmsg").text(""),$("#j_errmsg").text("登录中..."),$("#j_errmsg").css("color","#00f"),chrome.runtime.sendMessage({action:"login",account:e,pw:i},function(e){})}function LoginEnter(){13==event.keyCode&&Login()}function LoginResult(e){var t=JSON.parse(e);switch(t.code){case 0:$("#j_errmsg").html('*账号不存在<a href="http://linkedinjl.com/r" target="_black">立即注册</a>'),$("#j_errmsg").css("color","#f00");break;case 1:$("#j_errmsg").text("*密码错误"),$("#j_errmsg").css("color","#f00");break;case 2:var i=t.account;UpLoginTime();var n=t.login_code,o=Date.parse(t.reg_time),a=Date.parse(t.vip_time),r=Date.parse(t.dia_time),s=Date.parse(t.sup_time),c=(new Date).getTime();o<c-2592e6&&a<c&&r<c&&s<c?chrome.storage.sync.set({account:[i]},function(){ShowUp()}):(chrome.storage.sync.set({regTime:[o],vipTime:[a],diamondTime:[r],supremeTime:[s],account:[i],loginCode:[n]},function(){}),$("#j_account").text(i),$(".j-dialog").remove(),PointOut("登录成功",1),InitMember(a,r,s),ShowHelp());break;default:$("#j_errmsg").text("*登录失败"),$("#j_errmsg").css("color","#f00")}}function UpLoginTime(){var e=(new Date).getTime(),t=e+216e5;chrome.storage.sync.set({logintime:[t]},function(){})}function InitMember(e,t,i){var n=new Date(t).Format("yyyy-MM-dd"),o=new Date(e).Format("yyyy-MM-dd"),a=new Date(i).Format("yyyy-MM-dd"),r=CheckLevel(e,t,i);switch(chrome.storage.sync.set({level:[r]},function(){InitUi()}),r){case 0:$("#j_level").removeClass("j-level-vip"),$("#j_level").removeClass("j-level-dia"),$("#j_level").removeClass("j-level-sup"),$("#j_level").addClass("j-level-general"),$("#j_level").attr("title","普通会员");break;case 1:$("#j_level").removeClass("j-level-general"),$("#j_level").removeClass("j-level-dia"),$("#j_level").removeClass("j-level-sup"),$("#j_level").addClass("j-level-vip"),e>1923264e6?$("#j_level").attr("title","VIP会员到期时间：终身"):$("#j_level").attr("title","VIP会员到期时间："+o);break;case 2:$("#j_level").removeClass("j-level-general"),$("#j_level").removeClass("j-level-vip"),$("#j_level").removeClass("j-level-sup"),$("#j_level").addClass("j-level-dia"),t>1923264e6?$("#j_level").attr("title","钻石会员到期时间：终身"):$("#j_level").attr("title","钻石会员到期时间："+n);break;case 3:$("#j_level").removeClass("j-level-general"),$("#j_level").removeClass("j-level-dia"),$("#j_level").removeClass("j-level-vip"),$("#j_level").addClass("j-level-sup"),i>1923264e6?($("#j_level").attr("title","至尊会员到期时间：终身"),$("#j_upvip").css("display","none")):($("#j_level").attr("title","至尊会员到期时间："+a),$("#j_upvip").css("display","none"));break;default:$("#j_level").removeClass("j-level-vip"),$("#j_level").removeClass("j-level-dia"),$("#j_level").removeClass("j-level-sup"),$("#j_level").addClass("j-level-general"),$("#j_level").attr("title","普通会员"),$("#j_upvip").css("display","block")}}function LogOut(){chrome.storage.sync.set({run:!1,logintime:1,vipTime:1,diamondTime:1,supremeTime:1,level:0},function(){StopAction(),InitLogin()})}function UpVip(){chrome.storage.sync.get({account:""},function(e){var t="http://linkedinjl.com/upvip/acc/"+e.account;window.open(t)})}function CheckLevel(e,t,i){var n=(new Date).getTime();return i>n?3:t>n?2:e>n?1:0}function CheckLogin(){chrome.storage.sync.get({account:"",loginCode:""},function(e){var t=String(e.account),i=String(e.loginCode);t&&i&&chrome.runtime.sendMessage({action:"checkLogin",account:t,logincode:i},function(e){})})}function CheckLoginResult(e){e||LogOut()}function ShowInvitePage(){if(InvitePage){$("#j_invite_box").empty();$("#j_invite_box").append('<div class="j-explain-box j-w"><p>现在领英取消了批量撤回功能，只能一个一个撤回。领英精灵的撤回功能则可以实现批量撤回。</p><p style="color:#999;">点击“已发送”显示未通过的邀请，选择要撤回的邀请，最后点击“批量撤回”按钮</p></div>'),$("#j_invite_tool").css("visibility","hidden"),ShowPaging("j_invite_paging",1,0,100),InvitePage=!1}}function GetHasSent(){GetSent(1)}function GetSent(e){var t=getCookie("JSESSIONID").replace(/"/g,"");if(!t)return PointOut("获取失败"),!1;PointOut("正在获取中...",3);$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/genericInvitationFacets?q=sent",type:"get",headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"x-restli-protocol-version":"2.0.0"},success:function(i){if(i&&i.data&&i.data.elements){for(var n=i.data.elements,o=0;o<n.length;o++)if("CONNECTION"==n[o].invitationType){var a=parseInt(n[o].count);if(a>0){var r=100*(e-1),s={count:100,invitationType:"CONNECTION",q:"invitationType",start:r};$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/sentInvitationViewsV2",type:"get",data:s,headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"x-restli-protocol-version":"2.0.0"},success:function(t){if(t&&t.data&&t.data["*elements"]&&t.included){$("#j_invite_box").empty();var i=t.data["*elements"];if(i.length>0){for(var n=t.included,o=0;o<i.length;o++){var r={};r.invite_urn=i[o].split(":")[6];for(var s=0;s<n.length;s++)if("com.linkedin.voyager.relationships.invitation.Invitation"==n[s].$type&&n[s].entityUrn.split(":")[3]==r.invite_urn){r.urn=n[s].toMemberId,r.sentTime=n[s].sentTime;for(var c=0;c<n.length;c++)if("com.linkedin.voyager.identity.shared.MiniProfile"==n[c].$type&&n[c].entityUrn.split(":")[3]==r.urn){r.firstName=n[c].firstName,r.lastName=n[c].lastName,r.position=n[c].occupation,r.publicId=n[c].publicIdentifier,n[c].picture&&n[c].picture.rootUrl&&n[c].picture.artifacts&&n[c].picture.artifacts[0]?r.img=n[c].picture.rootUrl+n[c].picture.artifacts[0].fileIdentifyingUrlPathSegment:r.img="http://linkedinjl.com/expand/version8/img/me.png";break}break}AppendInvite(r)}$("#j_invite_tool").css("visibility","visible"),ShowPaging("j_invite_paging",e,a,100)}}else{$("#j_invite_box").empty();$("#j_invite_box").append('<div class="j-explain-box j-w"><p style="text-align:center;">您没有未通过的邀请。</p></div>'),$("#j_invite_tool").css("visibility","hidden"),PointOut("获取完成"),ShowPaging("j_invite_paging",1,0,100)}}})}break}}else PointOut("获取失败")}})}function AppendInvite(e){var t=GetName(e.firstName,e.lastName);e.sentTime=new Date(e.sentTime).Format("yyyy-MM-dd HH:mm"),e.sentTime="邀请日期："+e.sentTime;var i='<div class="j-friend" id="i_'+e.invite_urn+'"><div class="j-nowrap"><div class="j-profile-box"><a href="https://www.linkedin.com/in/'+e.publicId+' "target="_black" title="打开该好友Linkedin主页"><div><img src="'+e.img+'"></div></a><div class="j-profile"><h3>'+t+'</h3><p class="j-show j-position">'+e.position+'</p><p class="j-show j-position">'+e.sentTime+'</p></div></div><div><input type="checkbox" name="invite" value="'+e.invite_urn+'"></div></div></div>';$("#j_invite_box").append(i)}function SelectAllInvite(){if($(this).prop("checked")){$("input[name='invite']").prop("checked",!0);var e=$("input[name='invite']:checkbox:checked").length;0==e?PointOut("没有可选，请点击“已发送”显示未通过的邀请",3):PointOut("选择了 "+e+" 位",1)}else $("input[name='invite']").prop("checked",!1)}function RecallBatch(){var e=$("input[name='invite']:checkbox:checked").length;if(e<=0)return PointOut("请选择要撤回的邀请"),!1;JlConfirm("确定要撤回选择的 "+e+" 个邀请吗？","确定"),$("#j_ok").on("click",function(){var e=[];$("input[name='invite']:checkbox:checked").each(function(){var t={};t.entityUrn="urn:li:fs_relInvitation:"+$.trim($(this).val()),t.genericInvitation=!1,t.genericInvitationType="CONNECTION",e.push(t)});var t=getCookie("JSESSIONID").replace(/"/g,"");if(!t)return PointOut("撤回失败"),!1;var i={inviteActionType:"ACTOR_WITHDRAW",inviteActionData:e};$.ajax({url:"https://www.linkedin.com/voyager/api/relationships/invitations?action=closeInvitations",type:"post",data:JSON.stringify(i),headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":t,"content-type":"application/json; charset=UTF-8","x-restli-protocol-version":"2.0.0"},success:function(e){if(e){PointOut("成功撤回");var t=1;$("#j_invite_paging").find(".j-curpage").length>0&&(t=parseInt($("#j_invite_paging").find(".j-curpage").val()))>1&&(t-=1),GetSent(t)}else PointOut("撤回失败")}})})}function JumpInvite(e){if(13==e.keyCode){var t=parseInt($(this).val());if(!/^[1-9][0-9]*$/.test(t))return PointOut("请输入正确的页数",3),!1;var i=parseInt($("#j_invite_paging .j-paging:last").text());return t>i?(PointOut("请输入有效页数: 1 - "+i+" 范围内",3),!1):(GetSent(t),!0)}}function GetInviteSomePage(){GetSent(parseInt($(this).text()))}function ShowSetPage(){chrome.storage.sync.get({s_min_speed:30,s_max_speed:60,s_skip:!0,s_skip_time:7,s_limit:100,a_min_speed:30,a_max_speed:60,a_limit:100,d_min_speed:60,d_max_speed:120,d_limit:100,t_min_speed:20,t_max_speed:40,t_limit:100,risk:!0,tips:!0},function(e){$("#s_min_speed").val(e.s_min_speed),$("#s_max_speed").val(e.s_max_speed),$("#s_skip").prop("checked",Boolean(e.s_skip)),$("#s_skip_time").val(e.s_skip_time),$("#s_limit").val(e.s_limit),$("#a_min_speed").val(e.a_min_speed),$("#a_max_speed").val(e.a_max_speed),$("#a_limit").val(e.a_limit),$("#d_min_speed").val(e.d_min_speed),$("#d_max_speed").val(e.d_max_speed),$("#d_limit").val(e.d_limit),$("#t_min_speed").val(e.t_min_speed),$("#t_max_speed").val(e.t_max_speed),$("#t_limit").val(e.t_limit),$("#j_risk").prop("checked",Boolean(e.risk)),$("#j_tips").prop("checked",Boolean(e.tips))})}function RestoreSet(){JlConfirm("所有的设置将恢复默认状态，确定要恢复默认吗？","确定"),$("#j_ok").on("click",function(){chrome.storage.sync.set({s_min_speed:30,s_max_speed:60,s_skip:!0,s_skip_time:7,s_limit:100,a_min_speed:30,a_max_speed:60,a_limit:100,d_min_speed:60,d_max_speed:120,d_limit:100,t_min_speed:20,t_max_speed:40,t_limit:100,risk:!0,tips:!0},function(){ShowSetPage(),PointOut("设置已恢复默认状态",2)})})}function SetSendMinSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e<5?(JlAlert("最小时间不能小于5秒！"),chrome.storage.sync.get({s_min_speed:30},function(e){$("#s_min_speed").val(e.s_min_speed)}),!1):e>499?(JlAlert("最小时间不能大于499秒！"),chrome.storage.sync.get({s_min_speed:30},function(e){$("#s_min_speed").val(e.s_min_speed)}),!1):void(e<30?(JlConfirm("发送速度太快，确定要设置这么快吗？"),$("#j_ok").on("click",function(){chrome.storage.sync.set({s_min_speed:[e]},function(){chrome.storage.sync.get({s_max_speed:60},function(t){var i=Math.round(2*e);t.s_max_speed<i&&chrome.storage.sync.set({s_max_speed:[i]},function(){$("#s_max_speed").val(i)})})})}),$("#j_cancel").on("click",function(){chrome.storage.sync.get({s_min_speed:30},function(e){$("#s_min_speed").val(e.s_min_speed)})})):chrome.storage.sync.set({s_min_speed:[e]},function(){chrome.storage.sync.get({s_max_speed:60},function(t){var i=Math.round(2*e);t.s_max_speed<i&&chrome.storage.sync.set({s_max_speed:[i]},function(){$("#s_max_speed").val(i)})})})):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({s_min_speed:30},function(e){$("#s_min_speed").val(e.s_min_speed)}),!1)}function SetSendMaxSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>999?(JlAlert("最大时间不能超过999秒"),chrome.storage.sync.get({s_max_speed:60},function(e){$("#s_max_speed").val(e.s_max_speed)}),!1):void chrome.storage.sync.get({s_min_speed:30},function(t){var i=Math.round(2*t.s_min_speed);e<i?(JlAlert("最大时间至少是最小时间的2倍"),chrome.storage.sync.set({s_max_speed:[i]},function(){$("#s_max_speed").val(i)})):chrome.storage.sync.set({s_max_speed:[e]},function(){})}):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({s_max_speed:60},function(e){$("#s_max_speed").val(e.s_max_speed)}),!1)}function SetSendSkip(){chrome.storage.sync.set({s_skip:$(this).prop("checked")},function(){})}function SetSendSkipTime(){var e=$.trim($(this).val());if(!/^\d+$/.test(e))return JlAlert("请输入正确天数!"),chrome.storage.sync.get({s_skip_time:7},function(e){$("#s_skip_time").val(e.s_skip_time)}),!1;e>90?(JlAlert("最多可跳过90天"),chrome.storage.sync.set({s_skip_time:90},function(){}),$("#s_skip_time").val(90)):chrome.storage.sync.set({s_skip_time:[e]},function(){})}function SetSendLimit(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>2e3?(chrome.storage.sync.get({s_limit:100},function(e){JlAlert("出于账号安全考虑，每天群发数量不可超过2000条！"),$("#s_limit").val(e.s_limit)}),!1):void(e>100?(JlConfirm("每天群发数量不宜太多，坚持要群发这么多吗？"),$("#j_cancel").on("click",function(){chrome.storage.sync.get({s_limit:100},function(e){$("#s_limit").val(e.s_limit)}),$(".dialog").remove()}),$("#j_ok").on("click",function(){chrome.storage.sync.set({s_limit:[e]},function(){}),$(".dialog").remove()})):chrome.storage.sync.set({s_limit:[e]},function(){})):(chrome.storage.sync.get({s_limit:100},function(e){$("#s_limit").val(e.s_limit),JlAlert("请输入正确数字！")}),!1)}function SetAddMinSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e<5?(JlAlert("最小时间不能小于5秒！"),chrome.storage.sync.get({a_min_speed:30},function(e){$("#a_min_speed").val(e.a_min_speed)}),!1):e>499?(JlAlert("最小时间不能大于499秒！"),chrome.storage.sync.get({a_min_speed:30},function(e){$("#a_min_speed").val(e.a_min_speed)}),!1):void(e<30?(JlConfirm("添加好友速度不宜太快，确定要设置这么快吗？"),$("#j_ok").on("click",function(){chrome.storage.sync.set({a_min_speed:[e]},function(){chrome.storage.sync.get({a_max_speed:60},function(t){var i=Math.round(2*e);t.a_max_speed<i&&chrome.storage.sync.set({a_max_speed:[i]},function(){$("#a_max_speed").val(i)})})})}),$("#j_cancel").on("click",function(){chrome.storage.sync.get({a_min_speed:30},function(e){$("#a_min_speed").val(e.a_min_speed)})})):chrome.storage.sync.set({a_min_speed:[e]},function(){chrome.storage.sync.get({a_max_speed:60},function(t){var i=Math.round(2*e);t.a_max_speed<i&&chrome.storage.sync.set({a_max_speed:[i]},function(){$("#a_max_speed").val(i)})})})):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({a_min_speed:30},function(e){$("#a_min_speed").val(e.a_min_speed)}),!1)}function SetAddMaxSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>999?(JlAlert("最大时间不能超过999秒"),chrome.storage.sync.get({a_max_speed:60},function(e){$("#a_max_speed").val(e.a_max_speed)}),!1):void chrome.storage.sync.get({a_min_speed:30},function(t){var i=Math.round(2*t.a_min_speed);e<i?(JlAlert("最大时间至少是最小时间的2倍"),chrome.storage.sync.set({a_max_speed:[i]},function(){$("#a_max_speed").val(i)})):chrome.storage.sync.set({a_max_speed:[e]},function(){})}):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({a_max_speed:60},function(e){$("#a_max_speed").val(e.a_max_speed)}),!1)}function SetAddLimit(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>2e3?(chrome.storage.sync.get({a_limit:100},function(e){JlAlert("出于账号安全考虑每天发送邀请量不能超过2000条！"),$("#a_limit").val(e.a_limit)}),!1):void(e>200?(JlConfirm("每天添加好友数量不宜太多，确定要设置这么多吗？"),$("#j_cancel").on("click",function(){chrome.storage.sync.get({vip:!1,a_limit:100},function(e){$("#a_limit").val(e.a_limit)}),$(".dialog").remove()}),$("#j_ok").on("click",function(){chrome.storage.sync.set({a_limit:[e]},function(){}),$(".dialog").remove()})):chrome.storage.sync.set({a_limit:[e]},function(){})):(chrome.storage.sync.get({a_limit:100},function(e){$("#a_limit").val(e.a_limit),JlAlert("请输入正确数字！")}),!1)}function SetDigMinSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e<30?(JlAlert("出于账号安全考虑，挖掘最小时间不能小于30秒！"),chrome.storage.sync.get({d_min_speed:60},function(e){$("#d_min_speed").val(e.d_min_speed)}),!1):e>499?(JlAlert("最小时间不能大于499秒！"),chrome.storage.sync.get({d_min_speed:60},function(e){$("#d_min_speed").val(e.d_min_speed)}),!1):void(e<50?(JlConfirm("挖掘速度太快，坚持要设置这么快吗？"),$("#j_ok").on("click",function(){chrome.storage.sync.set({d_min_speed:[e]},function(){chrome.storage.sync.get({d_max_speed:120},function(t){var i=Math.round(2*e);t.d_max_speed<i&&chrome.storage.sync.set({d_max_speed:[i]},function(){$("#d_max_speed").val(i)})})})}),$("#j_cancel").on("click",function(){chrome.storage.sync.get({d_min_speed:60},function(e){$("#d_min_speed").val(e.d_min_speed)})})):chrome.storage.sync.set({d_min_speed:[e]},function(){chrome.storage.sync.get({d_max_speed:120},function(t){var i=Math.round(2*e);t.d_max_speed<i&&chrome.storage.sync.set({d_max_speed:[i]},function(){$("#d_max_speed").val(i)})})})):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({d_min_speed:60},function(e){$("#d_min_speed").val(e.d_min_speed)}),!1)}function SetDigMaxSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>999?(JlAlert("最大时间不能超过999秒"),chrome.storage.sync.get({d_max_speed:120},function(e){$("#d_max_speed").val(e.d_max_speed)}),!1):void chrome.storage.sync.get({d_min_speed:60},function(t){var i=Math.round(2*t.d_min_speed);e<i?(JlAlert("最大时间至少是最小时间的2倍"),chrome.storage.sync.set({d_max_speed:[i]},function(){$("#d_max_speed").val(i)})):chrome.storage.sync.set({d_max_speed:[e]},function(){})}):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({d_max_speed:120},function(e){$("#d_max_speed").val(e.d_max_speed)}),!1)}function SetDigLimit(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>1e3?(chrome.storage.sync.get({d_limit:100},function(e){JlAlert("出于账号安全考虑，每天挖掘数量不能超过1000条！"),$("#d_limit").val(e.d_limit)}),!1):void(e>100?(JlConfirm("每天挖掘量不宜太多，坚持要设置这么多吗？"),$("#j_cancel").on("click",function(){chrome.storage.sync.get({d_limit:100},function(e){$("#d_limit").val(e.d_limit)}),$(".dialog").remove()}),$("#j_ok").on("click",function(){chrome.storage.sync.set({d_limit:[e]},function(){}),$(".dialog").remove()})):chrome.storage.sync.set({d_limit:[e]},function(){})):(chrome.storage.sync.get({d_limit:100},function(e){$("#d_limit").val(e.d_limit),JlAlert("请输入正确数字！")}),!1)}function SetThumbsMinSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e<5?(JlAlert("最小时间不能小于5秒！"),chrome.storage.sync.get({t_min_speed:20},function(e){$("#t_min_speed").val(e.t_min_speed)}),!1):e>499?(JlAlert("最小时间不能大于499秒！"),chrome.storage.sync.get({t_min_speed:20},function(e){$("#t_min_speed").val(e.t_min_speed)}),!1):void(e<30?(JlConfirm("点赞速度不宜太快，坚持要设置这么快吗？"),$("#j_ok").on("click",function(){chrome.storage.sync.set({t_min_speed:[e]},function(){chrome.storage.sync.get({t_max_speed:40},function(t){var i=Math.round(2*e);t.t_max_speed<i&&chrome.storage.sync.set({t_max_speed:[i]},function(){$("#t_max_speed").val(i)})})})}),$("#j_cancel").on("click",function(){chrome.storage.sync.get({t_min_speed:20},function(e){$("#t_min_speed").val(e.t_min_speed)})})):chrome.storage.sync.set({t_min_speed:[e]},function(){chrome.storage.sync.get({t_max_speed:40},function(t){var i=Math.round(2*e);t.t_max_speed<i&&chrome.storage.sync.set({t_max_speed:[i]},function(){$("#t_max_speed").val(i)})})})):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({t_min_speed:20},function(e){$("#t_min_speed").val(e.t_min_speed)}),!1)}function SetThumbsMaxSpeed(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>999?(JlAlert("最大时间不能超过999秒"),chrome.storage.sync.get({t_max_speed:40},function(e){$("#t_max_speed").val(e.t_max_speed)}),!1):void chrome.storage.sync.get({t_min_speed:20},function(t){var i=Math.round(2*t.t_min_speed);e<i?(JlAlert("最大时间至少是最小时间的2倍"),chrome.storage.sync.set({t_max_speed:[i]},function(){$("#t_max_speed").val(i)})):chrome.storage.sync.set({t_max_speed:[e]},function(){})}):(JlAlert("请输入正确的数字!"),chrome.storage.sync.get({t_max_speed:40},function(e){$("#t_max_speed").val(e.t_max_speed)}),!1)}function SetThumbsLimit(){var e=$.trim($(this).val());return/^[1-9][0-9]*$/.test(e)?e>2e3?(chrome.storage.sync.get({t_limit:100},function(e){JlAlert("出于账号安全考虑，每天点赞量不能超过2000条！"),$("#t_limit").val(e.t_limit)}),!1):void(e>100?(JlConfirm("每天点赞数量不宜太多，坚持要设置这么多吗？"),$("#j_cancel").on("click",function(){chrome.storage.sync.get({t_limit:100},function(e){$("#t_limit").val(e.t_limit)}),$(".dialog").remove()}),$("#j_ok").on("click",function(){chrome.storage.sync.set({t_limit:[e]},function(){}),$(".dialog").remove()})):chrome.storage.sync.set({t_limit:[e]},function(){})):(chrome.storage.sync.get({t_limit:100},function(e){$("#t_limit").val(e.t_limit),JlAlert("请输入正确数字！")}),!1)}function SetRisk(){$(this).prop("checked")?chrome.storage.sync.set({risk:!0},function(){}):(JlConfirm("风控可有效保护Linkedin账号，确定要关闭风控系统吗？","确定"),$("#j_ok").on("click",function(){chrome.storage.sync.set({risk:!1},function(){})}),$("#j_cancel").on("click",function(){chrome.storage.sync.get({risk:!0},function(e){$("#j_risk").prop("checked",Boolean(e.risk))})}))}function SetTips(){chrome.storage.sync.set({tips:$(this).prop("checked")},function(){})}function AboutMe(){window.open("http://linkedinjl.com/aboutme")}function Recover(){chrome.storage.sync.get({level:0,account:"",my_urn:""},function(e){var t=String(e.account),i=String(e.my_urn);return t||(CreatLoginDialog(),PointOut("请先登录领英精灵账号",1)),i?parseInt(e.level)<1?(ShowDiff("普通会员不支持数据同步功能","若要使用此功能，请升级会员使用，谢谢您的支持，具体区别如下："),!1):(JlConfirm("同步数据会覆盖现有的数据，确定要同步吗？"),void $("#j_ok").on("click",function(){chrome.runtime.sendMessage({action:"recover"},function(e){PointOut("正在同步数据中，完成前请不要关闭浏览器",3)})})):(JlConfirm("没有绑定Linkedin账号，请先绑定Linkedin账号，确定要绑定吗"),$("#j_ok").on("click",function(){BindLinkedin(!0)}),!1)})}function ShowLog(){chrome.runtime.sendMessage({action:"getLog"},function(e){})}function GetLogResult(e,t){switch(e){case 0:PointOut("日志显示失败，请尝试刷新页面或重启浏览器");break;case 1:chrome.storage.sync.get({s_today_num:0,d_today_num:0,a_today_num:0,t_today_num:0},function(e){for(var i='<div class="j-dialog j-div-center j-close-dialog"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><h3 style="text-align:center; margin:6px; color:#000;">操作日志</h3><div style="min-height:200px;" class="j-w"><table id="j_tab_log" class="j-tab j-tab-log"><thead><tr><th>日期</th><th title="通过领英精灵每天群发消息数量">群发消息</th><th title="领英精灵每天挖掘到的好友资料数量">挖掘资料</th><th title="通过领英精灵每天发出的邀请数量">加好友</th><th title="通过领英精灵每天批量点赞的数量">点赞</th></tr></thead><tbody style="max-height: 30px; overflow-y:auto;"><tr><td>今天</td><td>'+e.s_today_num+"</td><td>"+e.d_today_num+"</td><td>"+e.a_today_num+"</td><td>"+e.t_today_num+"</td></tr>",n=0;n<t.length;n++){i+="<tr><td>"+new Date(t[n].log_date).Format("yyyy-MM-dd")+"</td><td>"+t[n].send_num+"</td><td>"+t[n].dig_num+"</td><td>"+t[n].add_num+"</td><td>"+t[n].thumbs_num+"</td></tr>"}i+="</tbody></table></div></div></div>",$("#lyjl").append(i),$(".j-dialog").fadeIn(200)});break;default:PointOut("日志显示失败，请尝试刷新页面或重启浏览器")}}function ChangeLinkedin(){JlConfirm("确定要换绑领英账号吗？","确定"),$("#j_ok").on("click",function(){BindLinkedin(!0)})}function ShowProPose(){$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-box-sha j-bg-w"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>我的建议</h3></div></div><div class="j-prompt-cont"><div class="j-propose-box"></span><textarea id="j_propose" autofocus="autofocus" placeholder="欢迎提出您的宝贵建议，您的建议是我们改进的方向，我公司将认真听取您的建议（有关产品的问题、功能，需要添加什么功能都可以提出）。如被采纳，会赠送您一个月的VIP会员。" maxlength=1000></textarea></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_submit" class="j-bg-btn j-layout-btn">提交</button></div></div></div>'),$(".j-dialog").fadeIn(200),$("#j_propose").focus(),$("#j_submit").on("click",function(){var e=$.trim($("#j_propose").val());if(!e)return PointOut("建议内容不能为空"),$("#j_propose").focus(),!1;chrome.runtime.sendMessage({action:"upload",type:"savePropose",data:e,other:""},function(e){$(".j-dialog").remove(),PointOut("建议已提交，感谢您宝贵建议！")})})}function ShowLevel(){var e=$.trim($(this).attr("title"));chrome.storage.sync.get({level:0},function(t){switch(parseInt(t.level)){case 0:var i="您是普通会员";e="以下是各个会员的功能权限，具体区别如下：",ShowDiff(i,e);break;case 1:var i="您是VIP会员";e+="，以下是各个会员的功能权限，具体区别如下：",ShowDiff(i,e);break;case 2:var i="您是钻石会员";e+="，以下是各个会员的功能权限，具体区别如下：",ShowDiff(i,e);break;case 3:PointOut(e,1);break;default:var i="您是普通会员";e="以下是各个会员的功能权限，具体区别如下：",ShowDiff(i,e)}})}
function StartAddFriend(){chrome.storage.sync.get({run:!1,account:"",my_urn:""},function(e){if(e.run)return PointOut("正在批量操作中，请先停止操作，再进行批量加好友！",3),!1;var t=String(e.account),i=String(e.my_urn);if(!t)return PointOut("没有登录领英精灵，请登录领英精灵账号",1),CreatLoginDialog(),!1;if(!i)return JlConfirm("没有绑定Linkedin账号,请先绑定Linkeidn账号，确定要绑定吗！"),$("#j_ok").on("click",function(){BindLinkedin()}),!1;var n=window.location.href,o=new RegExp("search/results","i"),a=new RegExp("%22S%22","i"),r=new RegExp("%22O%22","i");if(o.test(n))return a.test(n)||r.test(n)?(SetInviteMsg(),!0):(PointOut("请选择2度或3度人脉"),!1);if("https://www.linkedin.com/mynetwork/"==n)return ActionCount=0,ShowStatu("批量加好友..."),AddFriendForRecom(),!0;$("#lyjl").append('<div class="j-dialog j-div-center j-close-dialog"><div class="j-prompt-box j-div-center j-bg-w j-box-sha" style="width:260px; text-align:center;"><div style="margin:36px auto;"><p>加好友前，请选择要添加的好友</p><div style="margin:12px;"><a href="https://www.linkedin.com/mynetwork/">添加系统推荐人脉</a></div><div style="margin:12px;"><a href=\'https://www.linkedin.com/search/results/people/?facetNetwork=%5B"S"%5D\'>添加精准搜索人脉</a></div></div></div></div>'),$(".j-dialog").fadeIn(200)})}function AddFriendForRecom(){chrome.storage.sync.get({a_min_speed:30,a_max_speed:60,a_today_num:0,a_limit:100,risk:!0},function(e){if(parseInt(e.a_today_num)>=parseInt(e.a_limit))return StopAction(),setTimeout(function(){alert("今日累计发送 "+parseInt(e.a_today_num)+" 条邀请，已超设置的每日最多邀请量，请明天再来邀请或在领英精灵界面将每日邀请量设置大些！")},50),!1;var t=$("ul.discover-entity-list li.discover-entity-card:first");if(t.length<1)return StopAction(),setTimeout(function(){alert("成功发送 "+ActionCount+" 条邀请。")},50),!1;$("ul.discover-entity-list li.discover-entity-card").length<20?$("html, body").animate({scrollTop:$(document).height()},500):$("html, body").animate({scrollTop:$(document).height()},0),t.find("footer button").click(),setTimeout(function(){t.remove()},1e3),ActionCount++;var i=parseInt(e.a_today_num)+1;chrome.storage.sync.set({a_today_num:[i]},function(){});var n=GetTime(parseInt(e.a_today_num),parseInt(e.a_min_speed),parseInt(e.a_max_speed),e.risk);Delayed_time=n,DelayedTime(),$("#j_success_count").text("本次："+ActionCount),$("#j_today_count").text("今日："+i),Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:"addFriendForRecom"},function(e){})},1e3*n)})}function SetInviteMsg(){chrome.storage.sync.get({invite_msg:""},function(e){var t='<div class="j-dialog j-div-center"><div class="j-prompt-box j-bg-w j-div-center j-box-sha"><div class="j-prompt-title j-bg2 j-nowrap-left"><div class = "j-ico j-ico-confirm"></div><h3>添加邀请消息</h3></div><div class="j-prompt-cont"><div class="j-nowrap" style="margin:6px;"><div style="margin-top:6px;" class="j-nowrap"><span>编辑邀请消息：</span></div><div class="j-name-btn-box"><button id="j_add_last" class="j-bg-btn j-layout-btn" style="margin-right:6px;">添加姓氏</button><button id="j_add_first" class="j-bg-btn j-layout-btn">添加名字</button></div></div><textarea id="j_invite_msg" class="j-bg-main j-msg-cont" placeholder="请输入个性邀请消息。若未设置，表示只发邀请，不添加邀请消息。" style="height:80px;">'+String(e.invite_msg)+'</textarea></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_add_invite" class="j-bg-btn j-layout-btn j-close-dialog">开始添加</button></div></div></div>';$("#lyjl").append(t),$(".j-dialog").fadeIn(200),$("#j_invite_msg").focus()})}function StartAddFriendForSearch(){ActionCount=0,ShowStatu("批量加好友..."),AddFriendForSearch()}function InsertFirstName(){InsertAfterText(document.getElementById("j_invite_msg"),"[FirstName]")}function InsertLastName(){InsertAfterText(document.getElementById("j_invite_msg"),"[LastName]")}function SaveInviteMsg(){var e=$.trim($(this).val());chrome.storage.sync.set({invite_msg:[e]},function(){})}function AddFriendForSearch(){chrome.storage.sync.get({a_min_speed:30,a_max_speed:60,a_limit:100,a_today_num:0,invite_msg:"",risk:!0},function(e){if(parseInt(e.a_today_num)>=parseInt(e.a_limit))return StopAction(),setTimeout(function(){alert("今日累计发送 "+parseInt(e.a_today_num)+" 条邀请，已超设置的每日最多邀请量，请明天再来邀请或在领英精灵界面将每日邀请量设置大些！")},50),!1;var t=$("li.search-result__occluded-item:first");if(t.length<1)return $(".artdeco-pagination__button--next").prop("disabled")?(StopAction(),setTimeout(function(){alert("本次成功发送 "+ActionCount+" 条邀请")},50),!1):($(".artdeco-pagination__button--next").click(),Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:"addFriendForSearch"},function(e){})},1e4),!1);$("li.search-result__occluded-item").length<7?$("html, body").animate({scrollTop:$(document).height()},500):$("html, body").animate({scrollTop:$(document).height()},0);var i=parseInt(t.find(".dist-value").text()),n=$.trim(ArrangeFid(decodeURIComponent(t.find(".search-result__info .search-result__result-link").attr("href")))),o=$.trim(t.find(".actor-name").text()),a=GetFirstName(o),r=GetLastName(o),s=t.find("[data-control-name=srp_profile_actions]"),c=$.trim(s.text());if(!(2!=i&&3!=i&&4!=i&&5!=i&&6!=i||s.prop("disabled")||"加为好友"!=c&&"Connect"!=c)&&n){var d=String(e.invite_msg);d=d.replace(/\[Name\]/g,o),d=d.replace(/\[FirstName\]/g,a),d=d.replace(/\[LastName\]/g,r),AddFriend(n,d),t.remove(),ActionCount++;var l=parseInt(e.a_today_num)+1,u=GetTime(parseInt(e.a_today_num),parseInt(e.a_min_speed),parseInt(e.a_max_speed),e.risk);return Delayed_time=u,DelayedTime(),$("#j_success_count").text("本次："+ActionCount),$("#j_today_count").text("今日："+l),Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:"addFriendForSearch"},function(e){})},1e3*u),!1}t.remove(),chrome.runtime.sendMessage({action:"loop",result:"addFriendForSearch"},function(e){})})}function AddFriend(e,t){var i=getCookie("JSESSIONID").replace(/"/g,""),n=randomString(22)+"==";if(t)var o={emberEntityName:"growth/invitation/norm-invitation",invitee:{"com.linkedin.voyager.growth.invitation.InviteeProfile":{profileId:e}},message:t,trackingId:n};else var o={emberEntityName:"growth/invitation/norm-invitation",invitee:{"com.linkedin.voyager.growth.invitation.InviteeProfile":{profileId:e}},trackingId:n};$.ajax({url:"https://www.linkedin.com/voyager/api/growth/normInvitations",type:"post",data:JSON.stringify(o),headers:{Accept:"application/vnd.linkedin.normalized+json+2.1","csrf-token":i,"content-type":"application/json; charset=UTF-8","x-restli-protocol-version":"2.0.0"},success:function(e){chrome.storage.sync.get({a_today_num:0},function(e){var t=parseInt(e.a_today_num)+1;chrome.storage.sync.set({a_today_num:[t]},function(){})})},error:function(e,t,i){return StopAction(),setTimeout(function(){alert("已达邀请上限，请撤回一些未通过的邀请或过一段时间再来添加")},50),!1}})}function randomString(e){e=e||22;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+0123456789",i=t.length,n="",o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*i));return n}function StartThumbs(){chrome.storage.sync.get({run:!1},function(e){if(e.run)return PointOut("正在批量操作中，请先停止操作，再进行批量点赞！",3),!1;var t=window.location.href;if(!new RegExp("/feed","i").test(t))return $("#lyjl").append('<div class="j-dialog j-div-center j-close-dialog"><div class="j-prompt-box j-bg-w j-div-center j-box-sha" style="width:260px; text-align:center;"><div style="margin:36px auto;"><p>点赞前，请先切换到Linkedin首页</p><div style="margin:12px;"><a href="https://www.linkedin.com/feed/">前往Linkedin首页</a></div></div></div></div>'),$(".j-dialog").fadeIn(200),!1;ActionCount=0,ShowStatu("批量点赞..."),Thumbs()})}function Thumbs(){chrome.storage.sync.get({t_min_speed:20,t_max_speed:40,t_limit:100,t_today_num:0,risk:!0},function(e){if(parseInt(e.t_today_num)>=parseInt(e.t_limit))return StopAction(),setTimeout(function(){alert("今日累计点赞 "+parseInt(e.t_today_num)+" 条，已超设置的每日最多点赞量，请明天再来点赞或在领英精灵界面将每日点赞量设置大些！")},50),!1;var t=$(".core-rail div.relative .ember-view:first");if(t.length<1)return StopAction(),setTimeout(function(){alert("本次成功点赞 "+ActionCount+" 条动态")},50),!1;if($(".core-rail div.relative .ember-view").length<5?$("html, body").animate({scrollTop:$(document).height()},200):$("html, body").animate({scrollTop:0},200),"true"==t.find("button.react-button__trigger").attr("aria-pressed"))t.remove(),Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:"thumbs"},function(e){})},500);else{t.find("button.react-button__trigger").click(),setTimeout(function(){t.remove()},2e3),ActionCount++;var i=parseInt(e.t_today_num)+1;chrome.storage.sync.set({t_today_num:[i]},function(){});var n=GetTime(parseInt(e.t_today_num),parseInt(e.t_min_speed),parseInt(e.t_max_speed),e.risk);Delayed_time=n,DelayedTime(),$("#j_success_count").text("本次："+ActionCount),$("#j_today_count").text("今日："+i),Timeout=setTimeout(function(){chrome.runtime.sendMessage({action:"loop",result:"thumbs"},function(e){})},1e3*n)}})}function GetName(e,t){return isChinese(t)?t+e:e+" "+t}function GetFirstName(e){return-1==e.indexOf(" ")?e.length>3?e.substring(2,e.length):e.substring(1,e.length):e.substring(0,e.indexOf(" "))}function GetLastName(e){return-1==e.indexOf(" ")?e.length>3?e.substring(0,2):e.substring(0,1):e.substring(e.indexOf(" ")+1)}function getCookie(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function isChinese(e){return!new RegExp(/[^\u4e00-\u9fa5]/,"i").test(e)}function PointOut(e,t){var i=t||3;$(".j-point-out").remove();var n='<div class="j-point-out j-div-center">'+e+"</div>";$("#lyjl").append(n),setTimeout(function(){$(".j-point-out").fadeOut(200),setTimeout(function(){$(".j-point-out").remove()},200)},1e3*i)}function JlConfirm(e,t){$(".j-dialog").remove();var i=t||"确定",n='<div class="j-dialog j-div-center"><div class="j-confirm-box j-div-center j-box-sha"><div class="j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-confirm"></div><h3>'+i+'</h3></div></div><div class="j-marg"><p>'+e+'</p></div><div style="text-align:right;"><button id="j_cancel" class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button id="j_ok" class="j-bg-btn j-layout-btn j-close-dialog">确定</button></div></div></div>';$("#lyjl").append(n),$(".j-dialog").fadeIn(0)}function JlAlert(e){var t='<div class="j-dialog j-div-center"><div class="j-confirm-box j-div-center j-box-sha"><div class="j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-warn"></div><h3>注意</h3></div></div><div class="j-marg"><p>'+e+'</p></div><div style="text-align:right;"><button class="j-bg-btn j-layout-btn j-close-dialog">确认</button></div></div></div>';$("#lyjl").append(t),$(".j-dialog").fadeIn(0)}function ShowHelp(){chrome.storage.sync.get({guide:!1},function(e){if(!e.guide){$(".j-dialog").remove();$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-login-box j-bg-w j-div-center j-box-sha"><div style="width:240px;"><div><h2 style="color:#0077b5; margin-top:-6px;">帮助手册</h2></div><ul class="j-guide"><li><a href="http://linkedinjl.com/h?o=group" target="_black">好友分组管理</a></li><li><a href="http://linkedinjl.com/h?o=dig" target="_black">导出好友资料</a></li><li><a href="http://linkedinjl.com/h?o=sendmsg" target="_black">批量群发消息</a></li><li><a href="http://linkedinjl.com/h?o=addfriend" target="_black">一键批量加好友</a></li><li><a href="http://linkedinjl.com/h?o=thumbs" target="_black">一键批量点赞</a></li></ul><div style="text-align:right; margin:6px;"><input id="j_guide_statu" type="checkbox">不再显示</div><div><button class="j-bg-btn j-close-dialog" style="width:100%;padding:6px;">确定</button></div></div></div></div>'),$(".j-dialog").fadeIn(200)}})}function SetGuideStatu(){chrome.storage.sync.set({guide:$(this).prop("checked")},function(){})}function ShowSetDetail(){$(".j-fold-head").removeClass("j-fold-head-active"),$(".j-svg-box").removeClass("j-svg-show"),$(this).next().is(":hidden")?($(".j-fold-content").slideUp(100),$(this).addClass("j-fold-head-active"),$(this).find(".j-svg-box").addClass("j-svg-show")):$(this).removeClass("j-fold-head-active"),$(this).next().slideToggle(100)}function ShowDiff(e,t){$(".j-dialog").remove();var i='<div class="j-dialog j-div-center"><div class="j-prompt-box j-div-center j-bg-w j-box-sha"><div class="j-prompt-title j-bg2 j-nowrap"><div class="j-nowrap"><div class = "j-ico j-ico-warn"></div><h3>会员权限</h3></div></div><div class="j-prompt-cont"><div class="j-diff-cont"><div><h2 class="j-warn">'+e+"</h2><p>"+t+'</p><div><table class="j-tab j-tab-diff" style="display:block;"><thead><tr><th style="width:40%;">功能</th><th style="width:60px;">钻石</th><th style="width:60px;">VIP</th><th style="width:60px;">普通</th><tr></thead><tbody  style="display:block; overflow: auto; height:350px"><tr><td title="将好友资料（电话、邮箱、社交账号、公司、职位、网址等）批量导出到Excel表格">导出好友资料</td><td class="j-usable">√</td><td class="j-unable">x</td><td class="j-unable">x</td></tr><tr><td title="挖掘好友资料（电话、邮箱、社交账号、公司、职位、网址等）">挖掘好友资料</td><td class="j-usable">√</td><td class="j-unable">x</td><td class="j-unable">x</td></tr><tr><td title="对Linkedin好友进行分组、备注管理">好友分组</td><td class="j-usable">√</td><td class="j-unable">x</td><td class="j-unable">x</td></tr><tr><td title="一键批量群发消息给所有好友">批量群发消息</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-unable">10/天</td></tr><tr><td title="恢复数据和设置">数据同步</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-unable">x</td></tr><tr><td title="群发消息时，指定天内发送过的可跳过，可避免重复发送">避免重复</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-unable">x</td></tr><tr><td title="一键批量自动加好友">批量加好友</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-usable">√</td></tr><tr><td title="批量撤回邀请">批量撤回</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-usable">√</td></tr><tr title="一键批量点赞"><td>批量点赞</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-usable">√</td></tr><tr title="添加到禁发名单的好友不会发消息"><td>禁发名单</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-usable">√</td></tr><tr title="群发消息时，可根据好友的姓名智能添加称呼"><td>智能称呼</td><td class="j-usable">√</td><td class="j-usable">√</td><td class="j-usable">√</td></tr></tbody></table></div></div><div class="j-prompt-ctrl"><button class="j-bg-btn j-layout-btn j-close-dialog">取消</button><button class="j-upvip-btn j-upvip j-bg-btn j-layout-btn">立即升级</button></div></div></div>';$("#lyjl").append(i),$(".j-dialog").fadeIn(200)}function ShowStatu(e){var t='<div id="j_statu_dialog" class="j-gdialog j-box-sha" title="请不要关闭此页面，如要操作，请先停止"><div class="j-statu-dialog j-box-sha"><div class="j-dialog-title j-bg2"><h3 style="color:#fff;">领英精灵</h3></div><div class="j-statu-content"><div class="j-statu-img"><img id="j-statu_img" src="http://linkedinjl.com/expand/version8/img/statu.gif"></div><p id="j_delayed_desc" title="倒计时/秒">开</p><p id="j_dialog_desc">'+e+'</p><hr><p id="j_success_count" title="本次操作完成的数量"></p><p id="j_today_count" title="今日累计完成的数量"></p><button id="j_stop_action" class="j-bg-btn j-layout-btn" style="margin-top:6px;">停止</button></div></div></div>';$("body").append(t),$(".j-gdialog").fadeIn(0),ShowDialog(),chrome.storage.sync.set({run:!0},function(){})}function StopAction(){clearTimeout(Timeout),clearInterval(Delayed),$(".j-gdialog").remove(),chrome.storage.sync.set({run:!1},function(){})}function GetTidings(e,t){var i=Tidings.length,n="";if(i>0){var o=parseInt(i*Math.random());n=Tidings[o],n=n.replace(/\[FirstName\]/g,e),n=n.replace(/\[LastName\]/g,t)}else n=!1;return n}function GetTime(e,t,i,n){var o=1;if(n)switch(!0){case e<100:o=1;break;case e<200:case e<400:o=e/100*.6;break;default:o=e/100*1.2}return parseInt(o*Math.ceil(Math.random()*(i-t)+t))}function DelayedTime(){clearInterval(Delayed),$("#j_delayed_desc").text(Delayed_time),Delayed=setInterval(function(){Delayed_time>0?(Delayed_time--,$("#j_delayed_desc").text(Delayed_time)):clearInterval(Delayed)},1e3)}function ArrangeFid(e){if(0==e.length)return"";var t=e.replace(/\/in\//g,"");return t=t.replace(/\//g,"")}function GPointOut(e,t){t=t||3,$(".j-gpoint-out").remove();var i='<div class="j-gpoint-out j-div-center">'+e+"</div>";$("body").append(i),setTimeout(function(){$(".j-gpoint-out").fadeOut(200),setTimeout(function(){$(".j-gpoint-out").remove()},200)},1e3*t)}function InitLog(){chrome.storage.sync.get({today:0,a_today_num:0,s_today_num:0,t_today_num:0,d_today_num:0},function(e){var t=new Date((new Date).toLocaleDateString()).getTime();if(0==parseInt(e.today))return chrome.storage.sync.set({today:[t]},function(){}),!1;t>parseInt(e.today)&&chrome.storage.sync.set({today:[t],s_today_num:0,a_today_num:0,t_today_num:0,d_today_num:0},function(){})})}function ShowUp(){$(".j-dialog").remove();$("#lyjl").append('<div class="j-dialog j-div-center"><div class="j-login-box j-bg-w j-div-center j-box-sha"><div style="width:240px;"><div class="j-prompt-ctrl"><h3 style="color:#f00;">试用期已过，请升级后使用，感谢支持。</h3></div><div class="j-prompt-ctrl"><button class="j-upvip-btn j-upvip j-bg-btn j-layout-btn" title="立即抢购优惠">立即升级</button></div><div class="j-prompt-ctrl" style="text-align:right;"><a href="javascript:;" id="j_change_account" title="登录其它领英精灵账号">切换账号</a></div></div></div></div>'),$(".j-dialog").fadeIn(200)}var FriendPage=!0,ProbePage=!0,InvitePage=!0,Friend=[],Tidings=[],CurPos,Timeout,Delayed,ActionCount,Delayed_time,GetFriendInterval,GetFriendCount=0,AutoFriend=[],AutoDigPos,PosX,PosY,Fid="",Dist="",ShowBubble=!0;!function(){BindEven()}(),$(document).ready(function(){AppendNav(),AppendWindow(),BindLinkedin(!1),StartAutoDig(),GetFriend(),InitLog()}),chrome.runtime.onMessage.addListener(function(e,t,i){switch(i({result:!0}),e.action){case"showDialog":ShowDialog();break;case"loginResult":LoginResult(e.data);break;case"checkLoginResult":CheckLoginResult(rquest.data);break;case"getFriendDetailResult":GetFriendDetailResult(e.result,e.friend);break;case"addWhitelistForRight":AddWhitelistForRight();break;case"getFriendForAddWhitelist":GetFriendForAddWhitelist(e.result,e.friend);break;case"getFriendGroupRightResult":GetFriendGroupRightResult(e.result,e.friend);break;case"getFriendToolbarResult":GetFriendToolbarResult(e.result,e.data);break;case"getAllTidingsResult":GetAllTidingsResult(e.result,e.tidings,e.tag);break;case"saveTidingsResult":SaveTidingsResult(e.result);break;case"deleteTidingsResult":DeleteTidingsResult(e.result);break;case"updateTidingsResult":UpdateTidingsResult(e.result);break;case"startSendMsgResult":StartSendMsgResult(e.result,e.tidings,e.tag,e.friend);break;case"checkSendResult":CheckSendResult(e.result,e.tag,e.friend);break;case"sendMsgForNoLoop":SendMsgForNoLoop();break;case"sendMsgForLoop":SendMsgForLoop();break;case"updateWhitelistResult":UpdateWhitelistResult(e.result,e.state,e.tag,e.friend);break;case"probeResult":ProbeResult(e.result,e.data);break;case"getWhitelistResult":GetWhitelistResult(e.data,e.total,e.page,e.count);break;case"getDigResult":GetDigResult(e.result,e.data,e.total,e.page,e.count);break;case"getGroupDigFriendResult":GetGroupDigFriendResult(e.result,e.friend);break;case"checkDigResult":CheckDigResult(e.result,e.urn,e.publicId,e.tag);break;case"saveDigDataResult":SaveDigDataResult(e.result,e.urn,e.tag,e.profile);break;case"getAutoDigFriendResult":GetAutoDigFriendResult(e.result,e.friend);break;case"deleteInvalidFriendResult":DeleteInvalidFriendResult(e.result,e.urn,e.tag);break;case"getProfileResult":GetProfileResult(e.result,e.data);break;case"groupForRight":GroupForRight(e.result,e.group);break;case"getGroupResult":GetGroupResult(e.result,e.data,e.tag,e.groupId);break;case"getAGroupResult":GetAGroupResult(e.result,e.data);break;case"getGroupFriendResult":GetGroupFriendResult(e.result,e.groupId,e.data,e.total,e.pos);break;case"saveNewGroupResult":SaveNewGroupResult(e.result,e.tag);break;case"groupingForBatchResult":GroupingForBatchResult(e.result);break;case"deleteGroupResult":DeleteGroupResult(e.result);break;case"moveGroupResult":MoveGroupResult(e.result,e.friend,e.tag);break;case"getFriendRemarkResult":GetFriendRemarkResult(e.result,e.friend);break;case"showRemarkResult":ShowRemarkResult(e.result,e.friend,e.tag);break;case"editFriendRemarkResult":EditFriendRemarkResult(e.result);break;case"getLogResult":GetLogResult(e.result,e.log);break;case"thumbs":Thumbs();break;case"addFriendForRecom":AddFriendForRecom();break;case"addFriendForSearch":AddFriendForSearch()}}),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},window.onbeforeunload=function(e){StopAction()};